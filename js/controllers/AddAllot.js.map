{"version":3,"sources":["controllers/AddAllot.js"],"names":["WeChat","controller","$scope","$http","$cookies","$timeout","$mdSidenav","$mdUtil","$cacheFactory","$modal","$mdDialog","StoreUser","CompanyId","Unit","Maintenance","AppId","ApiMapper","getItem","OpenId","localStorage","EquipmentName","OpenModalTag","Parameters","SourceId","UnitId","Source","TargetId","Target","Remark","EquipmentId","StoreList","EquipmentList","isSubmit","isWPStoreUser","IsUItoWP","IsAutoSetPosition","GetStore","sApi","url","method","cache","contentType","headers","Passport","success","Unitdata","_","each","Item1","UnitLeve4data","isSelected","Item2","push","Level2Name","RepairParameters","GetEquipment","alert","parameterStr","TopicType","ClassName","children","GetFacilities","data","JSON","stringify","EquipmentTypeClass","Items","Lists","EquipmentTypeName","EquipmentCode","SortNo","parseInt","equipmentType","index","Item","console","log","res","toggleRight","navID","toggle","closeDenav","close","store_close","e","then","EQ_close","ProvinceIds","AreaIds","UnitItem","isSelectLeve2","filter","Level2","isSelectLeve3","reLoadLeve4","length","Level3","isSelectLeve4","ShowArea","Equipment","PositionByTypeEquipmentTypeName","error","Messages"],"mappings":"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","file":"AddAllot.js","sourcesContent":["'use strict';\r\nWeChat.controller('AddAllotCtrl', [\"$scope\", \"$http\", \"$cookies\", \"$timeout\", \"$mdSidenav\", \"$mdUtil\", \"$cacheFactory\", \"$modal\", \"$mdDialog\", function($scope, $http, $cookies, $timeout, $mdSidenav, $mdUtil, $cacheFactory, $modal, $mdDialog) {\r\n  $scope.StoreUser = $cookies.StoreUser;\r\n  $scope.CompanyId = $cookies.CompanyId;\r\n  $scope.Unit = $cookies.Unit;\r\n  $scope.Maintenance = 0;\r\n  $scope.StoreUser = 1;\r\n  //取得openID\r\n  //流程是AppID(公眾號ID) > codeID(驗證碼) > openID(使用者在這個公眾號的ID) > (API) > 使用者資訊\r\n  $scope.AppId = ApiMapper.AppId;\r\n  $scope.OpenId = window.localStorage.getItem($scope.AppId);\r\n  $scope.EquipmentName = \"\";\r\n  $scope.OpenModalTag = \"Source\";\r\n  $scope.Parameters = {\r\n    \"MoveType\": 1,\r\n    \"SourceId\": $cookies.UnitId,\r\n    \"Source\": $cookies.Unit,\r\n    \"TargetId\": \"\",\r\n    \"Target\": \"\",\r\n    \"Remark\": \"\",\r\n    \"EquipmentId\": \"\",\r\n    \"EquipmentName\": \"\"\r\n  };\r\n  $scope.StoreList = []; //門店json\r\n  $scope.EquipmentList = [];\r\n  $scope.isSubmit = false;\r\n  $scope.isWPStoreUser = false;\r\n  $scope.IsUItoWP = false;\r\n  $scope.IsAutoSetPosition = false;\r\n  if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"c1a24352-46a1-4301-9b96-a67c92691336\") {\r\n    $scope.isWPStoreUser = true;\r\n    $scope.IsUItoWP = true;\r\n  };\r\n  //获取单位资料\r\n  $scope.GetStore = function() {\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/unit/maps',\r\n      method: 'GET',\r\n      cache: true,\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function(Unitdata) {\r\n      $scope.Unitdata = Unitdata;\r\n      // alert(JSON.stringify($scope.Unitdata));\r\n      _(Unitdata[1]).each(function(Item1) {\r\n        $scope.UnitLeve4data = [];\r\n        Item1.isSelected = false;\r\n        _(Unitdata[3]).each(function(Item2) {\r\n          $scope.UnitLeve4data.push(Item2);\r\n          if (Item2.Level2 == Item1.UnitId) {\r\n            Item2.Level2Name = Item1.Unit;\r\n            Item2.isSelected = false;\r\n          }\r\n          if (Item2.UnitId == $cookies.UnitId) {\r\n            $scope.RepairParameters.SourceId = Item2.UnitId;\r\n            $scope.RepairParameters.Source = Item2.Unit;\r\n            //$scope.UnitLeve4data.push(Item1);\r\n          }\r\n        });\r\n        $scope.StoreList.push(Item1);\r\n      });\r\n      $scope.GetEquipment($cookies.UnitId);\r\n    }).error(function(status) {\r\n      alert(\"获取部门信息错误！\");\r\n    });\r\n  };\r\n  $scope.GetStore();\r\n  //获取设备/设施\r\n  $scope.GetEquipment = function(UnitId) {\r\n    var parameterStr = {\r\n      'UnitId': $scope.Parameters.SourceId,\r\n      'TopicType': 1,\r\n      'Maintenance': $scope.Maintenance\r\n    };\r\n    if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"c1a24352-46a1-4301-9b96-a67c92691336\") {\r\n      parameterStr.TopicType = 3;\r\n      $scope.EquipmentList[0] = {\r\n        'EquipmentTypeClass': 0,\r\n        'ClassName': '设备',\r\n        'children': []\r\n      };\r\n      $scope.EquipmentList[1] = {\r\n        'EquipmentTypeClass': 1,\r\n        'ClassName': '设施',\r\n        'children': []\r\n      };\r\n      $scope.GetFacilities(); //获取设施列表\r\n    };\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipment/classification',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify(parameterStr)\r\n    }).success(function(data) {\r\n      $scope.EquipmentList = [{\r\n        'EquipmentTypeClass': 0,\r\n        'ClassName': '设备',\r\n        'children': []\r\n      }, {\r\n        'EquipmentTypeClass': 1,\r\n        'ClassName': '设施',\r\n        'children': []\r\n      }, {\r\n        'EquipmentTypeClass': 2,\r\n        'ClassName': '资讯',\r\n        'children': []\r\n      }, {\r\n        'EquipmentTypeClass': 99,\r\n        'ClassName': '其它',\r\n        'children': []\r\n      }];\r\n      if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"c1a24352-46a1-4301-9b96-a67c92691336\") {\r\n        $scope.EquipmentList[0].children = data;\r\n        // _($scope.EquipmentList[0].children).each(function (Item) {\r\n        //     Item.ClassName = Item.EquipmentTypeName;\r\n        // });\r\n      } else {\r\n        _(data).each(function(Items) {\r\n          var EquipmentList = Items.children;\r\n          _(EquipmentList).each(function(Lists) {\r\n            Lists.EquipmentTypeName = Items.EquipmentTypeName;\r\n            var EquipmentCode = Lists.EquipmentCode.split('-');\r\n            Lists.SortNo = parseInt(EquipmentCode[1]);\r\n            $scope.EquipmentList.forEach(function(equipmentType, index) {\r\n              if (equipmentType.EquipmentTypeClass == Lists.EquipmentTypeClass) {\r\n                $scope.EquipmentList[index].children.push(Lists);\r\n              };\r\n            });\r\n          });\r\n        });\r\n        _($scope.EquipmentList).each(function(Item) {\r\n          Item.children = _.sortBy(Item.children, 'SortNo');\r\n        });\r\n      }\r\n      console.log($scope.EquipmentList);\r\n    });\r\n  };\r\n  //获取王品设施列表\r\n  $scope.GetFacilities = function() {\r\n    var parameterStr = {\r\n      'UnitId': $scope.Parameters.SourceId,\r\n      'TopicType': 4,\r\n      'Maintenance': $scope.Maintenance\r\n    };\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipment/classification',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify(parameterStr)\r\n    }).success(function(res) {\r\n      _(res).each(function(Items) {\r\n        var EquipmentList = Items.children;\r\n        _(EquipmentList).each(function(Lists) {\r\n          Lists.EquipmentTypeName = Items.EquipmentTypeName;\r\n          var EquipmentCode = Lists.EquipmentCode.split('-');\r\n          Lists.SortNo = parseInt(EquipmentCode[1]);\r\n          $scope.EquipmentList[1].children.push(Lists);\r\n        });\r\n      });\r\n    });\r\n  };\r\n  $scope.toggleRight = function(navID) {\r\n    $scope.OpenModalTag = navID;console.log('open',navID);\r\n    if (navID !== \"EQ\" && navID !== \"Area\") {\r\n      $mdSidenav(\"Store\").toggle();\r\n    } else {\r\n      $mdSidenav(\"EQ\").toggle();\r\n    }\r\n  };\r\n  $scope.closeDenav = function(navID) {console.log('close',navID);\r\n    if (navID !== \"EQ\" && navID !== \"Area\") {\r\n      _($scope.UnitLeve4data).each(function(Item) {\r\n        Item.isSelected = false;\r\n      });\r\n      $mdSidenav(\"Store\").close();\r\n    } else {\r\n      $mdSidenav(\"EQ\").close();\r\n    }\r\n  };\r\n  //部门选择關閉滑出頁面\r\n  $scope.store_close = function(e) {\r\n    $mdSidenav('Store').close().then(function() {\r\n      if (e != \"\") {\r\n        if ($scope.OpenModalTag === \"Source\") {\r\n          $scope.Parameters.SourceId = e.UnitId;\r\n          $scope.Parameters.Source = e.Unit;\r\n          $scope.GetEquipment(e.UnitId);\r\n        } else if ($scope.OpenModalTag === \"Target\") {\r\n          $scope.Parameters.TargetId = e.UnitId;\r\n          $scope.Parameters.Target = e.Unit;\r\n        }\r\n      }\r\n    });\r\n  };\r\n  //设施设备modal关闭事件\r\n  $scope.EQ_close = function(e) {\r\n    $mdSidenav('EQ').close().then(function() {});\r\n  };\r\n  $scope.AreaIds = [];\r\n  $scope.ProvinceIds = [];\r\n  $scope.isSelectLeve2 = function(UnitItem) {\r\n    _($scope.Unitdata[1]).each(function(Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) {\r\n      $scope.AreaIds = [UnitItem.UnitId];\r\n      $scope.ProvinceIds = [];\r\n    }\r\n    $scope.UnitLeve3data = _($scope.Unitdata[2]).filter(function(Item) {\r\n      return Item.Level2 == UnitItem.UnitId;\r\n    });\r\n  };\r\n  $scope.isSelectLeve3 = function(UnitItem) {\r\n    _($scope.Unitdata[2]).each(function(Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) {\r\n      $scope.ProvinceIds = [UnitItem.UnitId];\r\n    }\r\n  };\r\n  $scope.reLoadLeve4 = function() {\r\n    $scope.UnitLeve4data = _($scope.Unitdata[3]).filter(function(Item) {\r\n      if ($scope.ProvinceIds.length > 0) {\r\n        return Item.Level3 == $scope.ProvinceIds[0];\r\n      } else {\r\n        return Item.Level2 == $scope.AreaIds[0];\r\n      }\r\n    });\r\n  };\r\n  $scope.isSelectLeve4 = function(UnitItem) {\r\n    _($scope.UnitLeve4data).each(function(Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) { //將門店資料帶回\r\n      if ($scope.OpenModalTag === \"Source\") {\r\n        $scope.Parameters.SourceId = UnitItem.UnitId;\r\n        $scope.Parameters.Source = UnitItem.Unit;\r\n        $scope.GetEquipment(UnitItem.UnitId);\r\n      } else if ($scope.OpenModalTag === \"Target\") {\r\n        $scope.Parameters.TargetId = UnitItem.UnitId;\r\n        $scope.Parameters.Target = UnitItem.Unit;\r\n      }\r\n    }\r\n  };\r\n  //选择设备帶入地區資料\r\n  $scope.ShowArea = function(Equipment, PositionByTypeEquipmentTypeName) {\r\n    $scope.Parameters.EquipmentId = Equipment.EquipmentId;\r\n    $scope.EquipmentName = Equipment.EquipmentName;\r\n    $scope.EQ_close('');\r\n  };\r\n  $scope.Submit_Allot = function() {\r\n    if ($scope.Parameters.EquipmentId == \"\") {\r\n      alert(\"请选择调拨品项\");\r\n    } else {\r\n      $http({\r\n        url: ApiMapper.sApi + '/s/moveOder/create',\r\n        method: 'POST',\r\n        contentType: 'application/json',\r\n        headers: {\r\n          'Passport': $cookies.Passport\r\n        },\r\n        data: $scope.Parameters\r\n      }).success(function(data) {\r\n        $scope.isSubmit = false;\r\n        alert(\"调拨成功！详情请只调拨列表查看。\");\r\n        $scope.Parameters = {\r\n          \"MoveType\": 1,\r\n          \"SourceId\": $cookies.UnitId,\r\n          \"Source\": $cookies.Unit,\r\n          \"TargetId\": \"\",\r\n          \"Target\": \"\",\r\n          \"Remark\": \"\",\r\n          \"EquipmentId\": \"\"\r\n        };\r\n      }).error(function(data) {\r\n        $scope.isSubmit = false;\r\n        alert(data.Messages);\r\n      });\r\n    }\r\n  };\r\n}]);"]}
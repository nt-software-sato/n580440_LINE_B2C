{"version":3,"sources":["controllers/Apply.js"],"names":["WeChat","controller","$scope","$http","$cookies","$timeout","$mdSidenav","$mdUtil","$cacheFactory","$modal","$mdDialog","i18n","RepairParameters","window","localStorage","getItem","AppId","Maintenance","InspectionStyle","StoreList","CauseList","EquipmentName","AreaStr","itemsAreaStr","itemsCauseStr","Unit","PriorityId","CauseSelect","Record","isStore","isStart","isplayVoice","isSubmit","isShowSetting","isWPStoreUser","CompanyId","isShowArea","StoreUser","StoreSearch","imagesList","allIds","serverIds","localId","SettingInfo","nCount","nWidth","nLong","StageId","UserId","UserName","UnitId","IPositionIds","ICauseIds","CauseId","Causes","Description","ImageMediaIds","VoiceMediaId","MediasParamenter","Key","Medias","image","voice","equipment","EquipmentTypeClass","EquipmentTypeId","EquipmentTypeName","EquipmentCode","EquipmentList","children","ClassName","Equipmentpos","TypeList","IsShowToScanQRCode","IsShowAddCause","Client_Permissions","indexOf","IsWPStylePriorityList","IsAutoSetPosition","Load_WX","wx","config","debug","appId","timestamp","nonceStr","jsApiList","res","error","ApiMapper","url","method","cache","data","contentType","success","ticket","location","href","setItem","String1","exists","item","list","GetStore","sApi","Passport","console","log","t","Unitdata","Item1","UnitLeve4data","forEach","Item2","isSelected","push","CompanyInfo","status","AreaIds","UnitItem","ProvinceIds","Item","isSelectLeve2","_","filter","Level2","isSelectLeve3","reLoadLeve4","length","Level3","isSelectLeve4","SetEstDate","EstArrivalTime","GetNow","FormatDate","val","$","showDropdowns","format","singleDatePicker","setInspection","Tag","IsInspection","reloadParameters","ICauses","AreasList","PriorityList","ToscanQRCode","scanQRCode","scanType","needResult","resultStr","QRCodeStr","encodeURIComponent","headers","EquipmentId","GetPriority","GetCause","GetMaintainer","MaintainerId","MaintainerName","StrongholdId","GetMaintainerInfo","ccApi","StrongholdInfo","StrongholdName","Liaison","Name","toString","GetEquipment","parameterStr","TopicType","GetFacilities","stringify","JSON","each","Items","Lists","split","index","SortNo","sortBy","reloadCause","_CauseList","Priority","Emergency","Limitation","PositionByTypeEquipmentTypeName","ShowArea","IsRezPhotos","Equipment","PositionIds","List","Selected","toggleForArea","Region","Position","PositionId","EQ_close","idx","splice","existsForArea","setSelect4Cause","destroy","off","select2","placeholder","change","toArray","objItem","modal","isOpenSetting","Items01","Items02","show","clickOutsideToClose","createCause","Cause","then","param","NewCause","closeDialog","hide","value","getCause4Inspection","InspectionCauseList","PriorityParamerters","CauseIds","IsSupportArea","PriorityCount","SetPriority","ischecked","hasUrgent","alert","AddEquipmentModalInstance","AddEquipmentCtr","size","resolve","openAddEquipment","open","animation","templateUrl","chooseWhole","WholeIds","result","Array","$apply","prototype","apply","localIds","i","attr","src","RemoveWhole","chooseImage","RemoveImg","startRecord","stopRecord","onVoiceRecordEnd","complete","playVoice","onVoicePlayEnd","pauseVoice","stopVoice","serverId","CloseBrowser","uploadVoice","closeWindow","onLoad02","n","rnd","Math","random","uploadImageIds","setTimeout","ClosedNo","SetClosedNo","onLoad01","uploadedId","upload","id","toUpperCase","fail","Submit_Repair","uploadimages","isShowProgressTips","LoadMedias","RequisitionId","wxApi","CaseNo","SubmitCount","undefined","concat","EstArrivalDate","_hh","_mm","getMinutes","_ss","FormatDateTime","getHours","myDate","_YY","getFullYear","_MM","getSeconds","SettingStr","submitURI","Date","getMonth","_DD","getDate","RequestTime","Receipt","StatusCode","toggleRight","navID","closeDenav","Messages","toggle","e","close","SetCauseIds","isNan4Long","isNan4Width","isNan4Count","nIdex","isNan4Height","emptyCount","isVerification","nHeight","isNaN","confirmAddSetting","nStatus","parseInt","setSetting","showConfirm","css","z-index","removeItem4Setting"],"mappings":"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","file":"Apply.js","sourcesContent":["WeChat.controller('ApplyRepairCtrl', [\"$scope\", \"$http\", \"$cookies\", \"$timeout\", \"$mdSidenav\", \"$mdUtil\", \"$cacheFactory\", \"$modal\", \"$mdDialog\", \"i18n\", function ($scope, $http, $cookies, $timeout, $mdSidenav, $mdUtil, $cacheFactory, $modal, $mdDialog, i18n) {\r\n  $scope.RepairParameters = {};\r\n  $scope.AppId = window.localStorage.getItem('b2c_appId');\r\n  $scope.Maintenance = 0;\r\n  $scope.InspectionStyle = 1;\r\n  $scope.StoreList = []; //門店json\r\n  $scope.CauseList = [];\r\n  $scope.EquipmentName = '';\r\n  $scope.AreaStr = \"\"; //最終已選擇區域名單    \r\n  $scope.itemsAreaStr = []; //已選擇區域暫存參數\r\n  $scope.itemsCauseStr = [];\r\n  $scope.PriorityId = \"\";\r\n  $scope.Unit = $cookies.Unit;\r\n  $scope.CauseSelect = [];\r\n  $scope.Record = {};\r\n  $scope.isStore = false;\r\n  $scope.isStart = false;\r\n  $scope.isplayVoice = false;\r\n  $scope.isSubmit = false;\r\n  $scope.isShowSetting = false;\r\n  $scope.isWPStoreUser = false;\r\n  $scope.isShowArea = true;\r\n  $scope.CompanyId = $cookies.CompanyId;\r\n  $scope.StoreUser = $cookies.StoreUser;\r\n  $scope.StoreSearch = \"\";\r\n  $scope.imagesList = {\r\n    'WholeIds': [],\r\n    'localIds': [],\r\n    'allIds': [],\r\n    'serverIds': []\r\n  };\r\n  $scope.Record = {\r\n    'localId': '',\r\n    'serverId': ''\r\n  };\r\n  $scope.SettingInfo = [{\r\n    \"nCount\": null,\r\n    \"nHeight\": null,\r\n    \"nWidth\": null,\r\n    \"nLong\": null\r\n  }];\r\n  $scope.RepairParameters = {\r\n    'StageId': 0,\r\n    'Source': 4,\r\n    'UserId': $cookies.UserId,\r\n    'UserName': $cookies.UserName,\r\n    'UnitId': $cookies.UnitId,\r\n    'Unit': $cookies.Unit,\r\n    'IPositionIds': [],\r\n    'ICauseIds': [],\r\n    'CauseId': '',\r\n    'Causes': '',\r\n    'Description': '',\r\n    'ImageMediaIds': [],\r\n    'VoiceMediaId': '',\r\n    'CompanyId': $cookies.CompanyId\r\n  };\r\n  $scope.MediasParamenter = {\r\n    'Key': '',\r\n    'FileSoure': 40,\r\n    'Medias': {\r\n      'image': [],\r\n      'voice': []\r\n    }\r\n  };\r\n  $scope.equipment = {\r\n    \"UnitId\": $cookies.UnitId,\r\n    \"Unit\": $cookies.Unit,\r\n    \"EquipmentTypeClass\": 0,\r\n    \"EquipmentTypeId\": \"\",\r\n    \"EquipmentTypeName\": \"\",\r\n    \"EquipmentName\": \"\",\r\n    \"EquipmentCode\": \"\",\r\n    \"IPositionIds\": []\r\n  };\r\n  $scope.EquipmentList = [{\r\n    'EquipmentTypeClass': 0,\r\n    'ClassName': '设备',\r\n    'children': []\r\n  }, {\r\n    'EquipmentTypeClass': 1,\r\n    'ClassName': '设施',\r\n    'children': []\r\n  }, {\r\n    'EquipmentTypeClass': 2,\r\n    'ClassName': '资讯',\r\n    'children': []\r\n  }, {\r\n    'EquipmentTypeClass': 99,\r\n    'ClassName': '其它',\r\n    'children': []\r\n  }];\r\n  $scope.Equipmentpos = [];\r\n  $scope.TypeList = [];\r\n  $scope.StoreUser = $cookies.StoreUser;\r\n  $scope.IsShowToScanQRCode = false;\r\n  $scope.IsShowAddCause = false;\r\n  $scope.IsWPStylePriorityList = false;\r\n  $scope.IsAutoSetPosition = false;\r\n  // 王品 5/23\r\n  var Client_Permissions = [\"f96f98e2-38f9-456a-9813-82d899536a82\", \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\", \"6c690014-2571-48db-ac5a-c6ba2572a3bb\", \"c1a24352-46a1-4301-9b96-a67c92691336\", \"C4B0E179-8121-487E-AA63-59635ACF2447\"];\r\n  if (Client_Permissions.indexOf($cookies.CompanyId) > -1) {\r\n    $scope.IsShowToScanQRCode = true;\r\n    $scope.IsShowAddCause = true;\r\n    $scope.IsWPStylePriorityList = true;\r\n    //if(parseInt($scope.StoreUser) === 1){\r\n    if ($cookies.CompanyId !== 'f96f98e2-38f9-456a-9813-82d899536a82' && $cookies.CompanyId !== 'c1a24352-46a1-4301-9b96-a67c92691336') {\r\n      $scope.isWPStoreUser = true;\r\n    }\r\n    //}\r\n  };\r\n  if (Client_Permissions.indexOf($cookies.CompanyId) > -1) {\r\n    $scope.IsAutoSetPosition = true;\r\n  };\r\n  //设定微信调用\r\n  $scope.Load_WX = function () {\r\n    wx.config({\r\n      debug: false,\r\n      appId: $scope.AppId,\r\n      timestamp: 1437377735,\r\n      nonceStr: 'n580440',\r\n      signature: window.localStorage.getItem($scope.AppId + \"_signature\"),\r\n      jsApiList: ['checkJsApi', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'translateVoice', 'startRecord', 'stopRecord', 'onRecordEnd', 'playVoice', 'pauseVoice', 'stopVoice', 'uploadVoice', 'downloadVoice', 'chooseImage', 'previewImage', 'uploadImage',  'getNetworkType', 'openLocation', 'getLocation', 'hideOptionMenu', 'showOptionMenu', 'closeWindow', 'scanQRCode', 'chooseWXPay', 'openProductSpecificView', 'addCard', 'chooseCard', 'openCard']\r\n    });\r\n    wx.error(function (res) {\r\n      $http({\r\n        url: ApiMapper.wxApi + '/wx/r/ticket/' + $scope.AppId,\r\n        method: 'GET',\r\n        cache: false,\r\n        contentType: 'application/json'\r\n      }).success(function (data) {\r\n        var ticket = data;\r\n        window.localStorage.setItem($scope.AppId + \"_ticket\", ticket);\r\n        var String1 = \"jsapi_ticket=\" + ticket + \"&noncestr=n580440&timestamp=1437377735&url=\" + window.location.href;\r\n        window.localStorage.setItem($scope.AppId + \"_signature\", hex_sha1(String1)); //alert(String1);\r\n        $scope.Load_WX();\r\n      });\r\n    });\r\n  };\r\n  $scope.Load_WX();\r\n  $scope.exists = function (item, list) {\r\n    return list.indexOf(item) > -1;\r\n  };\r\n  //获取单位资料\r\n  $scope.GetStore = function () {\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/unit/maps',\r\n      method: 'GET',\r\n      cache: true,\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function (Unitdata) {\r\n      console.log(i18n.t(\"1001\"))\r\n      $scope.Unitdata = Unitdata;\r\n      // alert(JSON.stringify($scope.Unitdata));\r\n      _.forEach(Unitdata[1], function (Item1) {\r\n        $scope.UnitLeve4data = [];\r\n        Item1.isSelected = false;\r\n        _.forEach(Unitdata[3], function (Item2) {\r\n          $scope.UnitLeve4data.push(Item2);\r\n          if (Item2.Level2 == Item1.UnitId) {\r\n            Item2.Level2Name = Item1.Unit;\r\n            Item2.isSelected = false;\r\n          }\r\n          if (Item2.UnitId == $cookies.UnitId) {\r\n            $scope.isStore = true;\r\n            $scope.Unit = Item2.Unit;\r\n            $scope.RepairParameters.UnitId = Item2.UnitId;\r\n            $scope.RepairParameters.Unit = Item2.Unit;\r\n            //$scope.UnitLeve4data.push(Item1);\r\n          }\r\n          if (!$scope.isStore) {\r\n            var CompanyInfo = Unitdata[0];\r\n            $scope.Unit = CompanyInfo[0].Unit;\r\n          }\r\n        });\r\n        $scope.StoreList.push(Item1);\r\n      });\r\n      $scope.GetEquipment($cookies.UnitId);\r\n    }).error(function (status) {\r\n      alert(\"获取部门信息错误！\");\r\n    });\r\n  };\r\n  $scope.GetStore();\r\n  $scope.AreaIds = [];\r\n  $scope.ProvinceIds = [];\r\n  $scope.isSelectLeve2 = function (UnitItem) {\r\n    _.forEach($scope.Unitdata[1],function (Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) {\r\n      $scope.AreaIds = [UnitItem.UnitId];\r\n      $scope.ProvinceIds = [];\r\n    }\r\n    $scope.UnitLeve3data = _.filter($scope.Unitdata[2],function (Item) {\r\n      return Item.Level2 == UnitItem.UnitId;\r\n    });\r\n  };\r\n  $scope.isSelectLeve3 = function (UnitItem) {\r\n    _.forEach($scope.Unitdata[2],function (Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) {\r\n      $scope.ProvinceIds = [UnitItem.UnitId];\r\n    }\r\n  };\r\n  $scope.reLoadLeve4 = function () {\r\n    $scope.UnitLeve4data = _.filter($scope.Unitdata[3],function (Item) {\r\n      if ($scope.ProvinceIds.length > 0) {\r\n        return Item.Level3 == $scope.ProvinceIds[0];\r\n      } else {\r\n        return Item.Level2 == $scope.AreaIds[0];\r\n      }\r\n    });\r\n  };\r\n  $scope.isSelectLeve4 = function (UnitItem) {\r\n    _.forEach($scope.UnitLeve4data,function (Item) {\r\n      Item.isSelected = false;\r\n      if (Item.UnitId == UnitItem.UnitId) {\r\n        UnitItem.isSelected = !UnitItem.isSelected;\r\n      }\r\n    });\r\n    if (UnitItem.isSelected) { //將門店資料帶回\r\n      $scope.Unit = UnitItem.Unit;\r\n      $scope.RepairParameters.Unit = UnitItem.Unit;\r\n      $scope.RepairParameters.UnitId = UnitItem.UnitId;\r\n      $scope.RepairParameters.EquipmentCode = '';\r\n      $scope.EquipmentName = '';\r\n      $scope.RepairParameters.ICauseIds = [];\r\n      $scope.CauseList = [];\r\n      $scope.itemsCauseStr = [];\r\n      $scope.ICauses = '';\r\n      $scope.setSelect4Cause();\r\n      $scope.GetEquipment($scope.RepairParameters.UnitId);\r\n    }\r\n  };\r\n  //设定保养预设时间\r\n  $scope.SetEstDate = function () {\r\n    $scope.RepairParameters.EstArrivalTime = GetNow();\r\n    $scope.EstArrivalTime = FormatDate(GetNow());\r\n    $('input[name=\"EstArrivalDate\"]').val($scope.EstArrivalTime);\r\n  };\r\n  $('input[name=\"EstArrivalDate\"]').daterangepicker({\r\n    singleDatePicker: true,\r\n    showDropdowns: false,\r\n    format: 'YYYY/MM/DD',\r\n    \"minDate\": GetNow()\r\n  });\r\n  //设定报修/保养\r\n  $scope.setInspection = function (Tag) {\r\n    $scope.Maintenance = Tag;\r\n    $scope.IsInspection = Tag == 0 ? false : true;\r\n    $scope.SetEstDate();\r\n    if ($scope.RepairParameters.UnitId != null && $scope.RepairParameters.UnitId != \"\") {\r\n      $scope.reloadParameters();\r\n      $scope.GetEquipment();\r\n    }\r\n  }\r\n  //重置报修信息\r\n  $scope.reloadParameters = function () {\r\n    $scope.AreaStr = \"\";\r\n    $scope.ICauses = \"\";\r\n    $scope.EquipmentName = \"\";\r\n    $scope.RepairParameters.EquipmentCode = '';\r\n    $scope.RepairParameters.EquipmentName = '';\r\n    $scope.AreasList = [];\r\n    $scope.CauseList = [];\r\n    $scope.PriorityList = [];\r\n    $scope.EquipmentList = [{\r\n      'EquipmentTypeClass': 0,\r\n      'ClassName': '设备',\r\n      'children': []\r\n    }, {\r\n      'EquipmentTypeClass': 1,\r\n      'ClassName': '设施',\r\n      'children': []\r\n    }, {\r\n      'EquipmentTypeClass': 2,\r\n      'ClassName': '资讯',\r\n      'children': []\r\n    }, {\r\n      'EquipmentTypeClass': 99,\r\n      'ClassName': '其它',\r\n      'children': []\r\n    }];\r\n  }\r\n  //调用微信扫一扫接口获取设备\r\n  $scope.ToscanQRCode = function () {\r\n    //微信扫一扫功能\r\n    wx.scanQRCode({\r\n      needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，\r\n      scanType: [\"qrCode\", \"barCode\"], // 可以指定扫二维码还是一维码，默认二者都有\r\n      success: function (res) {\r\n        $scope.QRCodeStr = res.resultStr;\r\n        //解密单位二维码信息\r\n        $http({\r\n          url: ApiMapper.sApi + \"/s/equipment/code/\" + encodeURIComponent($scope.QRCodeStr),\r\n          contentType: \"application/json\",\r\n          headers: {\r\n            \"Passport\": $cookies.Passport\r\n          },\r\n          method: \"GET\",\r\n        }).success(function (data) {\r\n          $scope.RepairParameters.EquipmentCode = data.EquipmentCode;\r\n          $scope.RepairParameters.EquipmentTypeId = data.EquipmentTypeId;\r\n          $scope.RepairParameters.EquipmentTypeClass = data.EquipmentTypeClass;\r\n          $scope.RepairParameters.EquipmentId = data.EquipmentId;\r\n          $scope.RepairParameters.EquipmentName = data.EquipmentName;\r\n          $scope.EquipmentName = '[' + data.EquipmentCode + \"]  \" + data.EquipmentName;\r\n          $scope.RepairParameters.IPositionIds = [];\r\n          $scope.RepairParameters.IPositionIds = data.IPositionIds;\r\n          $scope.GetPriority(); //加载报修时限数据\r\n          $scope.GetCause(); //加载报修原因\r\n          $scope.GetMaintainer();\r\n        }).error(function (data) {\r\n          alert(data.Messages);\r\n        });\r\n      }\r\n    });\r\n  };\r\n  //根据设备类别获取预设维修厂商\r\n  $scope.GetMaintainer = function () {\r\n    $http({\r\n      url: ApiMapper.sApi + \"/s/punit/allocated/\" + $scope.RepairParameters.EquipmentTypeClass + '/' + $scope.RepairParameters.EquipmentId,\r\n      contentType: \"application/json\",\r\n      headers: {\r\n        \"Passport\": $cookies.Passport\r\n      },\r\n      method: \"GET\",\r\n    }).success(function (data) {\r\n      $scope.RepairParameters.MaintainerId = data.MaintainerId;\r\n      $scope.RepairParameters.MaintainerName = data.MaintainerName;\r\n      $scope.RepairParameters.StrongholdId = data.StrongholdId;\r\n      $scope.RepairParameters.StrongholdName = data.StrongholdName;\r\n      $scope.GetMaintainerInfo();\r\n    }).error(function (data) {\r\n      alert(data.Messages);\r\n    });\r\n  };\r\n  //获取维修商资讯\r\n  $scope.GetMaintainerInfo = function () {\r\n    //$timeout(function () {\r\n    //获取部门信息\r\n    $http({\r\n      url: ApiMapper.ccApi + '/g/punit/' + $scope.RepairParameters.MaintainerId + '/' + $scope.RepairParameters.StrongholdId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      cache: false\r\n    }).success(function (data) {\r\n      var StrongholdInfo = $scope.RepairParameters.MaintainerName + '-' + $scope.RepairParameters.StrongholdName + \"\\n 联系人：\";\r\n      if (data.Liaison.length > 0) {\r\n        _.forEach(data.Liaison,function (Item) {\r\n          if (Item.Name != null && Item.Name != \"\") {\r\n            StrongholdInfo += Item.Name.toString();\r\n          }\r\n          if (Item.PhoneNo != null && Item.PhoneNo != \"\") {\r\n            StrongholdInfo += \"  联系电话：\" + Item.PhoneNo.toString() + \"\\n\";\r\n          }\r\n        });\r\n      }\r\n      $scope.RepairParameters.StrongholdInfo = StrongholdInfo;\r\n    });\r\n    //}, 200);\r\n  };\r\n  //获取设备/设施\r\n  $scope.GetEquipment = function (UnitId) {\r\n    $scope.reloadParameters();\r\n    var parameterStr = {\r\n      'UnitId': $scope.RepairParameters.UnitId,\r\n      'TopicType': 1,\r\n      'Maintenance': $scope.Maintenance\r\n    };\r\n    if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"C4B0E179-8121-487E-AA63-59635ACF2447\") {\r\n      parameterStr.TopicType = 3;\r\n      $scope.EquipmentList[0] = {\r\n        'EquipmentTypeClass': 0,\r\n        'ClassName': '设备',\r\n        'children': []\r\n      };\r\n      $scope.EquipmentList[1] = {\r\n        'EquipmentTypeClass': 1,\r\n        'ClassName': '设施',\r\n        'children': []\r\n      };\r\n      $scope.GetFacilities(); //获取设施列表\r\n    };\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipment/classification',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify(parameterStr)\r\n    }).success(function (data) {\r\n      if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"C4B0E179-8121-487E-AA63-59635ACF2447\") {\r\n        $scope.EquipmentList[0].children = data;\r\n        // _($scope.EquipmentList[0].children).each(function (Item) {\r\n        //     Item.ClassName = Item.EquipmentTypeName;\r\n        // });\r\n      } else {\r\n        $scope.EquipmentList = [{\r\n          'EquipmentTypeClass': 0,\r\n          'ClassName': '设备',\r\n          'children': []\r\n        }, {\r\n          'EquipmentTypeClass': 1,\r\n          'ClassName': '设施',\r\n          'children': []\r\n        }, {\r\n          'EquipmentTypeClass': 2,\r\n          'ClassName': '资讯',\r\n          'children': []\r\n        }, {\r\n          'EquipmentTypeClass': 99,\r\n          'ClassName': '其它',\r\n          'children': []\r\n        }];\r\n        _(data).each(function (Items) {\r\n          var EquipmentList = Items.children;\r\n          _(EquipmentList).each(function (Lists) {\r\n            Lists.EquipmentTypeName = Items.EquipmentTypeName;\r\n            var EquipmentCode = Lists.EquipmentCode.split('-');\r\n            Lists.SortNo = parseInt(EquipmentCode[1]);\r\n            $scope.EquipmentList.forEach(function (equipmentType, index) {\r\n              if (equipmentType.EquipmentTypeClass == Lists.EquipmentTypeClass) {\r\n                $scope.EquipmentList[index].children.push(Lists);\r\n              };\r\n            });\r\n          });\r\n        });\r\n        _($scope.EquipmentList).each(function (Item) {\r\n          Item.children = _.sortBy(Item.children, 'SortNo');\r\n        });\r\n      }\r\n    });\r\n  };\r\n  //获取王品设施列表\r\n  $scope.GetFacilities = function () {\r\n    var parameterStr = {\r\n      'UnitId': $scope.RepairParameters.UnitId,\r\n      'TopicType': 4,\r\n      'Maintenance': $scope.Maintenance\r\n    };\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipment/classification',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify(parameterStr)\r\n    }).success(function (res) {\r\n      _(res).each(function (Items) {\r\n        var EquipmentList = Items.children;\r\n        _(EquipmentList).each(function (Lists) {\r\n          Lists.EquipmentTypeName = Items.EquipmentTypeName;\r\n          var EquipmentCode = Lists.EquipmentCode.split('-');\r\n          Lists.SortNo = parseInt(EquipmentCode[1]);\r\n          $scope.EquipmentList[1].children.push(Lists);\r\n        });\r\n      });\r\n    });\r\n  };\r\n  $scope.reloadCause = function () {\r\n    $scope.CauseList = [];\r\n    $scope._CauseList = [];\r\n    $scope.PriorityList = [];\r\n    $scope.RepairParameters.Priority = '';\r\n    $scope.RepairParameters.Emergency = 0;\r\n    $scope.RepairParameters.Limitation = 0;\r\n  };\r\n  //选择设备帶入地區資料\r\n  $scope.ShowArea = function (Equipment, PositionByTypeEquipmentTypeName) {\r\n    //王品设施不显示区域 2019R5\r\n    if (PositionByTypeEquipmentTypeName === \"设施\" && $scope.isWPStoreUser) {\r\n      $scope.isShowArea = false;\r\n    } else {\r\n      $scope.isShowArea = true;\r\n    }\r\n    //写入设备资料到报修主档\r\n    if ($scope.RepairParameters.EquipmentCode == '') {\r\n      $scope.AreasList = [];\r\n      $scope.CauseList = [];\r\n      $scope.PriorityList = [];\r\n      $scope.ICauses = \"\";\r\n      $scope.RepairParameters.EquipmentTypeId = '';\r\n      $scope.RepairParameters.EquipmentTypeClass = '';\r\n      $scope.RepairParameters.EquipmentId = '';\r\n      $scope.RepairParameters.EquipmentName = '';\r\n      $scope.RepairParameters.IsRezPhotos = 0;\r\n      $scope.RepairParameters.IPositionIds = [];\r\n      $scope.RepairParameters.MaintainerId = '';\r\n      $scope.RepairParameters.StrongholdId = '';\r\n      $scope.RepairParameters.IsSupportArea = 0;\r\n      $scope.reloadCause();\r\n    }\r\n    $scope.RepairParameters.EquipmentCode = Equipment.EquipmentCode;\r\n    $scope.RepairParameters.EquipmentTypeId = Equipment.EquipmentTypeId;\r\n    $scope.RepairParameters.EquipmentTypeClass = Equipment.EquipmentTypeClass;\r\n    $scope.RepairParameters.EquipmentId = Equipment.EquipmentId;\r\n    $scope.RepairParameters.EquipmentName = Equipment.EquipmentName;\r\n    $scope.RepairParameters.IsRezPhotos = Equipment.IsRezPhotos;\r\n    $scope.RepairParameters.IPositionIds = Equipment.PositionIds.split();\r\n    $scope.RepairParameters.MaintainerId = Equipment.MaintainerId;\r\n    $scope.RepairParameters.StrongholdId = Equipment.StrongholdId;\r\n    $scope.RepairParameters.IsSupportArea = Equipment.IsSupportArea;\r\n    $scope.EquipmentName = '[' + $scope.RepairParameters.EquipmentCode + \"]  \" + $scope.RepairParameters.EquipmentName;\r\n    $scope.reloadCause();\r\n    if ($scope.IsInspection) {\r\n      $scope.getCause4Inspection();\r\n    } else {\r\n      $scope.GetCause(); //加载报修原因\r\n    }\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipmentpos/' + Equipment.EquipmentId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function (List, status) {\r\n      $scope.RepairParameters.IPositionIds = [];\r\n      $scope.itemsAreaStr = [];\r\n      $scope.AreaStr = '';\r\n      if (List.length == 1) {\r\n        _(List).each(function (Item) {\r\n          Item.Selected = true;\r\n        });\r\n        if ($scope.IsAutoSetPosition == false) {\r\n          $scope.toggleForArea(List[0]);\r\n        }\r\n      } else if (List.length > 1) {\r\n        _(List).each(function (Item) {\r\n          Item.Selected = false;\r\n        });\r\n      }\r\n      $scope.AreasList = List;\r\n      if ($scope.IsAutoSetPosition) {\r\n        List.forEach(function (item) {\r\n          if (item.Position == PositionByTypeEquipmentTypeName) {\r\n            $scope.itemsAreaStr.push(item.Region + '-' + item.Position);\r\n            $scope.RepairParameters.IPositionIds.push(item.PositionId);\r\n          };\r\n        });\r\n        $scope.AreaStr = $scope.itemsAreaStr.toString();\r\n      };\r\n    }).error(function (List, status) {});\r\n    if ($scope.IsAutoSetPosition) {\r\n      $scope.EQ_close('');\r\n    };\r\n  };\r\n  $scope.toggleForArea = function (item) {\r\n    var idx = $scope.RepairParameters.IPositionIds.indexOf(item.PositionId);\r\n    if (idx > -1) {\r\n      $scope.RepairParameters.IPositionIds.splice(idx, 1);\r\n      $scope.itemsAreaStr.splice(idx, 1);\r\n    } else {\r\n      $scope.RepairParameters.IPositionIds.push(item.PositionId);\r\n      $scope.itemsAreaStr.push(item.Region + '-' + item.Position);\r\n    }\r\n    $scope.AreaStr = $scope.itemsAreaStr.toString();\r\n  };\r\n  $scope.existsForArea = function (item, list) {\r\n    return list.indexOf(item) > -1;\r\n  };\r\n  //设定报修原因Select2\r\n  $scope.setSelect4Cause = function () {\r\n    /**取消王品新增报修原因功能20170801*/\r\n    // if($scope.CompanyId==\"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\"){\r\n    //     //$scope.CauseList=[{'CauseId':'','Cause':''}];\r\n    //     $(\"#multi-append\").select2({ tags: true,placeholder: \"请选择报修原因\"}).change(function () {\r\n    //         $timeout(function () {\r\n    //             $scope.RepairParameters.ICauseIds = _($(\"#multi-append\").select2(\"val\")).toArray(); \r\n    //         }, 200);\r\n    //     });\r\n    // }else{\r\n    $timeout(function () {\r\n      //$(\"#multi-append\").select2({ placeholder: \"请选择报修原因\",tags: true }).change(function () {\r\n      $(\"#multi-append\").data('select2').destroy();\r\n      $(\"#multi-append\").off(\"change\");\r\n      $(\"#multi-append\").select2({\r\n        placeholder: \"请选择报修原因\"\r\n      }).change(function () {\r\n        $timeout(function () {\r\n          $scope.RepairParameters.ICauseIds = _($(\"#multi-append\").select2(\"val\")).toArray();\r\n          if ($scope.RepairParameters.ICauseIds.length > 0) {\r\n            $scope.GetPriority(); //加载报修时限数据\r\n          };\r\n          var objItem = $(\"#multi-append\").select2(\"data\");\r\n          $scope.isOpenSetting = false;\r\n          _(objItem).each(function (item) {\r\n            if (item.text == \"亚克力板坏\" || item.text == \"亚克力门板坏\") {\r\n              $('#equipment_setting').modal('show');\r\n              $scope.isOpenSetting = true;\r\n            }\r\n          });\r\n          _($scope.CauseList).each(function (Items01) {\r\n            _(Items01.children).each(function (Items02) {\r\n              if (Items02.ICauseIds == $scope.RepairParameters.ICauseIds) {\r\n                $scope.RepairParameters.Priority = Items02.Priority;\r\n                $scope.RepairParameters.Emergency = Items02.Emergency;\r\n                $scope.RepairParameters.Limitation = Items02.Limitation;\r\n              }\r\n            });\r\n          });\r\n        }, 200);\r\n      });\r\n    }, 200);\r\n    // }    \r\n  };\r\n  //获取报修原因\r\n  $scope.GetCause = function () {\r\n    $scope.RepairParameters.ICauseIds = [];\r\n    $scope.itemsCauseStr = [];\r\n    $scope.ICauses = '';\r\n    if ($scope.RepairParameters.MaintainerId == null || $scope.RepairParameters.MaintainerId == \"\") {\r\n      $scope.RepairParameters.MaintainerId = 'None';\r\n    }\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipmentcause/' + $scope.RepairParameters.EquipmentId + '/' + $scope.RepairParameters.MaintainerId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify({\r\n        'EquipmentTypeId': $scope.RepairParameters.EquipmentTypeId,\r\n        'EquipmentName': $scope.RepairParameters.EquipmentName,\r\n        'MaintainerId': $scope.RepairParameters.MaintainerId\r\n      })\r\n    }).success(function (List, status) {\r\n      $scope.CauseList = [];\r\n      var CauseList = List.children;\r\n      _(CauseList).each(function (item) {\r\n        if (item.Status == 1) {\r\n          $scope.CauseList.push(item);\r\n        }\r\n      });\r\n      $scope.setSelect4Cause();\r\n    }).error(function (List, status) {});\r\n  };\r\n  //产生新原因\r\n  $scope.createCause = function () {\r\n    $mdDialog.show({\r\n      clickOutsideToClose: true,\r\n      scope: $scope,\r\n      preserveScope: true,\r\n      template: '<md-dialog>' +\r\n        '  <md-dialog-content>' +\r\n        '    <h5 class=\"md-title text-center\" style=\"font-size:14px;\">新增原因</h5>' +\r\n        '    <input type=\"text\" ng-model=\"Cause.value\" placeholder=\"请输入...\">' +\r\n        '  </md-dialog-content>' + '  <div class=\"md-actions\">' +\r\n        '    <md-button ng-click=\"cancelDialog()\" class=\"md-primary\">' +\r\n        '      取消' +\r\n        '    </md-button>' +\r\n        '    <md-button ng-click=\"closeDialog()\" class=\"md-primary\">' +\r\n        '      确定' +\r\n        '    </md-button>' +\r\n        '  </div>' +\r\n        '</md-dialog>',\r\n      controller: function DialogController($scope, $mdDialog) {\r\n        $scope.Cause = {\r\n          value: ''\r\n        };\r\n        $scope.cancelDialog = function () {\r\n          $mdDialog.cancel();\r\n        };\r\n        $scope.closeDialog = function () {\r\n          $mdDialog.hide($scope.Cause.value);\r\n        };\r\n      }\r\n    }).then(function (NewCause) {\r\n      if (NewCause != null && NewCause != \"\") {\r\n        var param = {\r\n          \"Cause\": NewCause,\r\n          \"EquipmentId\": $scope.RepairParameters.EquipmentId,\r\n          \"StoreUser\": $scope.StoreUser\r\n        };\r\n        $http({\r\n          url: ApiMapper.sApi + '/s/equipmentcause/create',\r\n          method: 'Post',\r\n          contentType: 'application/json',\r\n          headers: {\r\n            'Passport': $cookies.Passport\r\n          },\r\n          data: JSON.stringify(param)\r\n        }).success(function (data, status) {\r\n          if ($scope.IsInspection) {\r\n            $scope.getCause4Inspection();\r\n          } else {\r\n            $scope.GetCause(); //加载报修原因\r\n          }\r\n        }).error(function (error, status) {\r\n          alert(error.Messages);\r\n        });\r\n      }\r\n    }, function () {\r\n      // console.log('cancel');\r\n    });\r\n  };\r\n  //获取保养设备原因\r\n  $scope.getCause4Inspection = function () {\r\n    $scope.RepairParameters.CauseIds = \"\";\r\n    $scope.itemsCauseStr = [];\r\n    $scope.ICauses = '';\r\n    // if($scope.RepairParameters.MaintainerId==null||$scope.RepairParameters.MaintainerId==\"\"){$scope.RepairParameters.MaintainerId='None';}\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/equipmentcause/inspect/' + $scope.RepairParameters.EquipmentId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function (List, status) {\r\n      $scope.InspectionCauseList = [];\r\n      var InspectionCauseList = List.children;\r\n      _(InspectionCauseList).each(function (item) {\r\n        if (item.Status == 1) {\r\n          $scope.InspectionCauseList.push(item);\r\n        }\r\n      });\r\n    }).error(function (List, status) {});\r\n  }\r\n  //获取报修时限\r\n  $scope.GetPriority = function () {\r\n    $scope.PriorityList = [];\r\n    var PriorityParamerters = {\r\n      \"EquipmentTypeClass\": $scope.RepairParameters.EquipmentTypeClass,\r\n      \"EquipmentId\": $scope.RepairParameters.EquipmentId,\r\n      \"MaintainerId\": $scope.RepairParameters.MaintainerId,\r\n      \"CauseIds\": $scope.RepairParameters.ICauseIds,\r\n      \"IsSupportArea\": $scope.RepairParameters.IsSupportArea\r\n    };\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/priority',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: JSON.stringify(PriorityParamerters)\r\n    }).success(function (List, status) {\r\n      $scope.PriorityList = [];\r\n      $scope.PriorityCount = 0;\r\n      _(List).each(function (Items) {\r\n        if (Items.EquipmentTypeClass == $scope.RepairParameters.EquipmentTypeClass || Items.EquipmentTypeClass == 99) {\r\n          Items.ischecked = false;\r\n          $scope.PriorityCount += 1;\r\n          $scope.PriorityList.push(Items);\r\n        }\r\n      });\r\n      // 王品不預設第一個選項\r\n      // 王品 5/23\r\n      if (['eb296708-6fc6-43f0-b506-0ca0fa91e1cd', '6c690014-2571-48db-ac5a-c6ba2572a3bb', 'f96f98e2-38f9-456a-9813-82d899536a82', 'C4B0E179-8121-487E-AA63-59635ACF2447'].indexOf($cookies.CompanyId) == -1) {\r\n        $scope.PriorityList[0].ischecked = true;\r\n        $scope.RepairParameters.PriorityId = $scope.PriorityList[0].PriorityId;\r\n        $scope.RepairParameters.Priority = $scope.PriorityList[0].Priority;\r\n        $scope.RepairParameters.Emergency = $scope.PriorityList[0].Emergency;\r\n        $scope.RepairParameters.Limitation = $scope.PriorityList[0].Limitation;\r\n      };\r\n    }).error(function (List, status) {});\r\n  };\r\n  //设定报修时限\r\n  $scope.SetPriority = function (Priority) {\r\n    _($scope.PriorityList).each(function (Items) {\r\n      Items.ischecked = false;\r\n      if (Items.PriorityId == Priority.PriorityId) {\r\n        Items.ischecked = true;\r\n      }\r\n    });\r\n    // 王品 5/23 增加85 7/25\r\n    if (['308ffed8-d4a7-4ad5-8b61-6cce3c66cd06', 'eb296708-6fc6-43f0-b506-0ca0fa91e1cd', '6c690014-2571-48db-ac5a-c6ba2572a3bb', 'f96f98e2-38f9-456a-9813-82d899536a82', 'C4B0E179-8121-487E-AA63-59635ACF2447'].indexOf($cookies.CompanyId) > -1) {\r\n      var hasUrgent = Priority.Priority.indexOf('紧急');\r\n      if (hasUrgent !== -1) {\r\n        alert('请注意，紧急报修上门费比一般报修高！');\r\n      }\r\n    };\r\n    $scope.RepairParameters.PriorityId = Priority.PriorityId;\r\n    $scope.RepairParameters.Priority = Priority.Priority;\r\n    $scope.RepairParameters.Emergency = Priority.Emergency;\r\n    $scope.RepairParameters.Limitation = Priority.Limitation;\r\n  };\r\n  $scope.openAddEquipment = function () {\r\n    var AddEquipmentModalInstance = $modal.open({\r\n      animation: true,\r\n      templateUrl: 'app/CaseList/SearchGroup/Case_search_equipment_add.html',\r\n      controller: AddEquipmentCtr,\r\n      size: 'md',\r\n      resolve: {\r\n        UnitId: function () {\r\n          return $scope.RepairParameters.UnitId;\r\n        },\r\n        Unit: function () {\r\n          return $scope.RepairParameters.Unit;\r\n        }\r\n      }\r\n    });\r\n    AddEquipmentModalInstance.result.then(function (result) {\r\n      $scope.GetEquipment($scope.RepairParameters.UnitId);\r\n    }, function () {});\r\n  };\r\n  //整体照片\r\n  $scope.chooseWhole = function () {\r\n    wx.chooseImage({\r\n      sourceType: ['album', 'camera'],\r\n      success: function (res) {\r\n        if ($scope.imagesList.WholeIds.length > 0) {\r\n          //$scope.imagesList.localIds = $scope.imagesList.localIds.concat(res.localIds);\r\n          Array.prototype.push.apply($scope.imagesList.WholeIds, res.localIds);\r\n        } else {\r\n          $scope.imagesList.WholeIds = res.localIds;\r\n        }\r\n        $scope.imagesList.serverIds = [];\r\n        $scope.$apply();\r\n        $timeout(function () {\r\n          _($scope.imagesList.WholeIds).each(function (Item, i) {\r\n            $('#wholePic' + i).attr({\r\n              'src': Item,\r\n              'width': '72px',\r\n              'height': '72px'\r\n            });\r\n          });\r\n        }, 500);\r\n      }\r\n    });\r\n  };\r\n  //删除照片\r\n  $scope.RemoveWhole = function (idx) {\r\n    $scope.imagesList.WholeIds.splice(idx, 1);\r\n  };\r\n  //局部照片\r\n  $scope.chooseImage = function () {\r\n    wx.chooseImage({\r\n      sourceType: ['album', 'camera'],\r\n      success: function (res) {\r\n        if ($scope.imagesList.localIds.length > 0) {\r\n          //$scope.imagesList.localIds = $scope.imagesList.localIds.concat(res.localIds);\r\n          Array.prototype.push.apply($scope.imagesList.localIds, res.localIds);\r\n        } else {\r\n          $scope.imagesList.localIds = res.localIds;\r\n        }\r\n        $scope.imagesList.serverIds = [];\r\n        $scope.$apply();\r\n        $timeout(function () {\r\n          _($scope.imagesList.localIds).each(function (Item, i) {\r\n            $('#advPic' + i).attr({\r\n              'src': Item,\r\n              'width': '72px',\r\n              'height': '72px'\r\n            });\r\n          });\r\n        }, 500);\r\n      }\r\n    });\r\n  };\r\n  //删除照片\r\n  $scope.RemoveImg = function (idx) {\r\n    $scope.imagesList.localIds.splice(idx, 1);\r\n  };\r\n  //语音\r\n  $scope.startRecord = function () {\r\n    wx.startRecord({\r\n      success: function (res) {\r\n        $scope.isStart = true;\r\n        $scope.$apply();\r\n      }\r\n    });\r\n  };\r\n  $scope.stopRecord = function () {\r\n    wx.stopRecord({\r\n      success: function (res) {\r\n        $scope.isStart = false;\r\n        $scope.Record.localId = res.localId;\r\n        $scope.$apply();\r\n      }\r\n    });\r\n  };\r\n  wx.onVoiceRecordEnd({\r\n    complete: function (res) {\r\n      $scope.Record.localId = res.localId;\r\n      alert('录音时间已超过一分钟');\r\n    }\r\n  });\r\n  //播放录音\r\n  $scope.playVoice = function () {\r\n    $scope.isplayVoice = !$scope.isplayVoice;\r\n    if ($scope.isplayVoice) {\r\n      if ($scope.Record.localId == '') {\r\n        alert('请先录音！');\r\n        return;\r\n      }\r\n      wx.playVoice({\r\n        localId: $scope.Record.localId\r\n      });\r\n      //监听语音播放完毕接口\r\n      wx.onVoicePlayEnd({\r\n        success: function (res) {\r\n          $scope.isplayVoice = false;\r\n        }\r\n      });\r\n    } else {\r\n      wx.pauseVoice({\r\n        localId: $scope.Record.localId\r\n      });\r\n    }\r\n  };\r\n  //暂停播放音频\r\n  $scope.pauseVoice = function () {\r\n    wx.pauseVoice({\r\n      localId: $scope.Record.localId\r\n    });\r\n  };\r\n  //停止播放音频\r\n  $scope.stopVoice = function () {\r\n    wx.stopVoice({\r\n      localId: $scope.Record.localId\r\n    });\r\n  };\r\n  //监听语音播放完毕接口\r\n  wx.onVoicePlayEnd({\r\n    success: function (res) {\r\n      $scope.isplayVoice = false;\r\n    }\r\n  });\r\n  //上传录音档\r\n  $scope.UpdateRecord = function () {\r\n    wx.uploadVoice({\r\n      localId: $scope.Record.localId,\r\n      success: function (res) {\r\n        $scope.Record.serverId = res.serverId;\r\n      }\r\n    });\r\n  };\r\n  //关闭微信浏览器\r\n  $scope.CloseBrowser = function () {\r\n    //WeixinJSBridge.call('closeWindow');\r\n    wx.closeWindow();\r\n  };\r\n  //生成销案密码\r\n  $scope.SetClosedNo = function (n) {\r\n    var rnd = \"\";\r\n    for (var i = 0; i < n; i++) rnd += Math.floor(Math.random() * 10);\r\n    return rnd;\r\n  };\r\n  $scope.RepairParameters.ClosedNo = $scope.SetClosedNo(4);\r\n  //上传\r\n  $scope.onLoad01 = true;\r\n  $scope.onLoad02 = true;\r\n  var i = 0;\r\n  var length = $scope.imagesList.allIds.length;\r\n  $scope.uploadImageIds = {};\r\n  $scope.upload = function () {\r\n    setTimeout(function () {\r\n      var uploadedId = $scope.uploadImageIds[$scope.imagesList.allIds[i]];\r\n      if (typeof uploadedId === \"undefined\" || uploadedId === \"\") {\r\n        //获取本地图片Base64编码数据\r\n        // wx.getLocalImgData({\r\n        //   localId: $scope.imagesList.allIds[i], // 图片的localID\r\n        //   success: function (res) {\r\n        //     var localData = res.localData; // localData是图片的base64数据，可以用img标签显示\r\n            \r\n        //   }\r\n        // });\r\n        var localId = $scope.imagesList.allIds[i].toString();\r\n        //解决IOS无法上传的坑\r\n        if (localId.indexOf(\"wxlocalresource\") != -1) {\r\n          localId = localId.replace(\"wxlocalresource\", \"wxLocalResource\");\r\n        }\r\n        wx.uploadImage({\r\n          localId: localId,\r\n          isShowProgressTips: 1,\r\n          success: function (res) {\r\n            //保存至已上传图片对象\r\n            res.id = res.serverId.toUpperCase();\r\n            $scope.uploadImageIds[$scope.imagesList.allIds[i]] = res.serverId;\r\n            i++;\r\n            $scope.imagesList.serverIds.push(res.serverId);\r\n            $scope.RepairParameters.ImageMediaIds.push(res.serverId);\r\n            $scope.MediasParamenter.Medias.image.push(res.serverId);\r\n            if (i < length) {\r\n              $scope.upload();\r\n            } else {\r\n              $scope.onLoad01 = false;\r\n              $scope.Submit_Repair();\r\n            }\r\n          },\r\n          fail: function (error) {\r\n            $scope.imagesList.serverIds = [];\r\n            $scope.RepairParameters.ImageMediaIds = [];\r\n            $scope.MediasParamenter.Medias.image = [];\r\n            alert(\"上传图片发生服务器错误！ \");\r\n          }\r\n        });\r\n      } else {\r\n        i++;\r\n        $scope.imagesList.serverIds.push(uploadedId);\r\n        $scope.RepairParameters.ImageMediaIds.push(uploadedId);\r\n        $scope.MediasParamenter.Medias.image.push(uploadedId);\r\n        if (i < length) {\r\n          $scope.upload();\r\n        } else {\r\n          $scope.onLoad01 = false;\r\n          $scope.Submit_Repair();\r\n        }\r\n      }\r\n    }, 100);\r\n  };\r\n  $scope.uploadimages = function () {\r\n    if ($scope.onLoad01) {\r\n      $scope.imagesList.serverIds = [];\r\n      $scope.MediasParamenter.Medias.image = [];\r\n      $scope.RepairParameters.ImageMediaIds = [];\r\n      i = 0;\r\n      length = $scope.imagesList.allIds.length;\r\n      $scope.upload();\r\n    }\r\n  };\r\n  $scope.uploadVoice = function () {\r\n    if ($scope.onLoad02) {\r\n      wx.uploadVoice({\r\n        localId: $scope.Record.localId,\r\n        isShowProgressTips: 1,\r\n        success: function (res) {\r\n          $scope.Record.serverId = res.serverId;\r\n          $scope.onLoad02 = false;\r\n          $scope.RepairParameters.VoiceMediaId = $scope.Record.serverId;\r\n          $scope.MediasParamenter.Medias.voice = [];\r\n          $scope.MediasParamenter.Medias.voice.push($scope.Record.serverId);\r\n          $scope.Submit_Repair();\r\n        },\r\n        fail: function (error) {\r\n          $scope.RepairParameters.VoiceMediaId = [];\r\n          $scope.MediasParamenter.Medias.voice = [];\r\n          alert(\"上传发生服务器错误！ \");\r\n        }\r\n      });\r\n    }\r\n  };\r\n  //保存媒体档案到580440\r\n  $scope.LoadMedias = function (RequisitionId) {\r\n    $scope.MediasParamenter.Key = RequisitionId;\r\n    //alert(JSON.stringify($scope.MediasParamenter));\r\n    $http({\r\n      url: ApiMapper.wxApi + '/wx/files/' + $scope.AppId,\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: $scope.MediasParamenter\r\n    }).success(function (data) {\r\n      if (data != \"Saved\") {\r\n        $scope.isSubmit = false;\r\n        alert('报修失败！\\n\\r请联系580-440报修中心！');\r\n        return false;\r\n      } else {\r\n        $scope.isSubmit = false;\r\n        alert('成功报修！\\n\\r单号：' + $scope.CaseNo);\r\n        $scope.CloseBrowser();\r\n      }\r\n    }).error(function (List, status) {\r\n      $scope.isSubmit = false;\r\n      alert('报修失败！\\n\\r请联系580-440报修中心！');\r\n    });\r\n  };\r\n  //送出报修\r\n  $scope.SubmitCount = 0;\r\n  $scope.Submit_Repair = function () {\r\n    if (!$scope.IsInspection) {\r\n      if ($scope.RepairParameters.PriorityId == '' || $scope.RepairParameters.PriorityId == undefined) {\r\n        $scope.isSubmit = false;\r\n        alert('请选择报修原因及报修时限！');\r\n        return false;\r\n      };\r\n    };\r\n    if ($scope.RepairParameters.IsRezPhotos == 1) {\r\n      if ($scope.imagesList.WholeIds.length == 0) {\r\n        $scope.isSubmit = false;\r\n        alert('请上传报修整体照片！');\r\n        return false;\r\n      } else if ($scope.imagesList.localIds.length == 0) {\r\n        $scope.isSubmit = false;\r\n        alert('请上传报修局部照片！');\r\n        return false;\r\n      }\r\n    }\r\n    $scope.imagesList.allIds = $scope.imagesList.WholeIds.concat($scope.imagesList.localIds);\r\n    $scope.isSubmit = true;\r\n    if ($scope.imagesList.allIds.length > 0 && $scope.onLoad01) {\r\n      $scope.uploadimages();\r\n    } else if ($scope.Record.localId != \"\" && $scope.onLoad02) {\r\n      $scope.uploadVoice();\r\n    } else {\r\n      if ($scope.SubmitCount == 0) {\r\n        $scope.SubmitCount = 1;\r\n        //alert( JSON.stringify($scope.RepairParameters));\r\n        if ($scope.RepairParameters.UnitId == '' || $scope.RepairParameters.UnitId == undefined) {\r\n          $scope.isSubmit = false;\r\n          $scope.SubmitCount = 0;\r\n          alert('请选择报修单位！');\r\n          return false;\r\n        } else if ($scope.RepairParameters.EquipmentCode == '' || $scope.RepairParameters.EquipmentCode == undefined) {\r\n          $scope.isSubmit = false;\r\n          $scope.SubmitCount = 0;\r\n          alert('请选择报修设备！');\r\n          return false;\r\n        }\r\n        if (!$scope.IsInspection) {\r\n          if (($scope.RepairParameters.ICauseIds.length == 0 || $scope.RepairParameters.ICauseIds == undefined) && $scope.RepairParameters.Description == '') {\r\n            $scope.isSubmit = false;\r\n            $scope.SubmitCount = 0;\r\n            alert('请说明报修原因！');\r\n            return false;\r\n          } else if ($scope.RepairParameters.PriorityId == '' || $scope.RepairParameters.PriorityId == undefined) {\r\n            $scope.isSubmit = false;\r\n            $scope.SubmitCount = 0;\r\n            alert('请选择维修时限！');\r\n            return false;\r\n          }\r\n        }\r\n        if ($scope.IsInspection) {\r\n          if ($scope.RepairParameters.CauseIds == \"\") {\r\n            $scope.isSubmit = false;\r\n            alert('请选择保养类型！');\r\n            return false;\r\n          }\r\n          if ($scope.RepairParameters.EstArrivalTime == \"\") {\r\n            $scope.isSubmit = false;\r\n            alert('请选择保养预计到场时间！');\r\n            return false;\r\n          } else {\r\n            $scope.RepairParameters.EstArrivalTime = FormatDateTime($scope.RepairParameters.EstArrivalTime);\r\n            var EstArrivalDate = $('input[name=\"EstArrivalDate\"]').val();\r\n            var myDate = new Date($scope.RepairParameters.EstArrivalTime);\r\n            var _hh = myDate.getHours();\r\n            var _mm = myDate.getMinutes();\r\n            var _ss = myDate.getSeconds();\r\n            $scope.RepairParameters.EstArrivalTime = '' + EstArrivalDate + ' ' + _hh + ':' + _mm + ':' + _ss;\r\n          }\r\n        }\r\n        if ($scope.isOpenSetting) {\r\n          $scope.RepairParameters.Description = $scope.RepairParameters.Description + \"\\n\\r\" + $scope.SettingStr;\r\n        }\r\n        var myDate = new Date();\r\n        var _YY = myDate.getFullYear();\r\n        var _MM = myDate.getMonth() + 1;\r\n        var _DD = myDate.getDate();\r\n        var _hh = myDate.getHours();\r\n        var _mm = myDate.getMinutes();\r\n        var _ss = myDate.getSeconds();\r\n        $scope.RepairParameters.RequestTime = '' + _YY + '/' + _MM + '/' + _DD + ' ' + _hh + ':' + _mm + ':' + _ss;\r\n        var submitURI = \"s/rez\";\r\n        if ($scope.IsInspection) {\r\n          submitURI = \"s/inspect\";\r\n        }\r\n        $http({\r\n          url: ApiMapper.sApi + '/' + submitURI,\r\n          method: 'POST',\r\n          contentType: 'application/json',\r\n          headers: {\r\n            'Passport': $cookies.Passport\r\n          },\r\n          data: $scope.RepairParameters\r\n        }).success(function (data) {\r\n          if (data.Receipt.StatusCode != 1) {\r\n            $scope.isSubmit = false;\r\n            $scope.SubmitCount = 0;\r\n            alert('报修失败！\\n\\r请联系580-440报修中心！');\r\n            return false;\r\n          } else {\r\n            if ($scope.imagesList.allIds.length > 0 || $scope.Record.localId != \"\") {\r\n              $scope.CaseNo = data.CaseNo;\r\n              $scope.LoadMedias(data.RequisitionId);\r\n            } else {\r\n              $scope.isSubmit = false;\r\n              alert('成功报修！\\n\\r单号：' + data.CaseNo);\r\n              $scope.CloseBrowser();\r\n            }\r\n          }\r\n        }).error(function (error, status) {\r\n          $scope.SubmitCount = 0;\r\n          $scope.isSubmit = false;\r\n          alert(error.Messages);\r\n        });\r\n      }\r\n    }\r\n  };\r\n  $scope.toggleRight = function (navID) {\r\n    $mdSidenav(navID).toggle();\r\n  };\r\n  $scope.closeDenav = function (navID) {\r\n    $mdSidenav(navID).close();\r\n  };\r\n  //部门选择關閉滑出頁面\r\n  $scope.store_close = function (e) {\r\n    $mdSidenav('Store').close().then(function () {\r\n      if (e != \"\") {\r\n        //將門店資料帶回\r\n        $scope.Unit = e.Unit;\r\n        $scope.RepairParameters.Unit = e.Unit;\r\n        $scope.RepairParameters.UnitId = e.UnitId;\r\n        $scope.RepairParameters.EquipmentCode = '';\r\n        $scope.EquipmentName = '';\r\n        $scope.RepairParameters.ICauseIds = [];\r\n        $scope.CauseList = [];\r\n        $scope.itemsCauseStr = [];\r\n        $scope.ICauses = '';\r\n        $scope.setSelect4Cause();\r\n        $scope.GetEquipment($scope.RepairParameters.UnitId);\r\n      }\r\n    });\r\n  };\r\n  //设施设备modal关闭事件\r\n  $scope.EQ_close = function (e) {\r\n    $mdSidenav('Area').close().then(function () {\r\n      $scope.RepairParameters.ICauseIds = [];\r\n      //$scope.CauseList = [];          \r\n      $scope.setSelect4Cause();\r\n    });\r\n  };\r\n  //设定报修原因并关闭页面\r\n  $scope.SetCauseIds = function (item) {\r\n    var idx = $scope.RepairParameters.ICauseIds.indexOf(item.CauseId);\r\n    if (idx > -1) {\r\n      $scope.RepairParameters.ICauseIds.splice(idx, 1);\r\n      $scope.itemsCauseStr.splice(idx, 1);\r\n    } else {\r\n      $scope.RepairParameters.ICauseIds.push(item.CauseId);\r\n      $scope.itemsCauseStr.push(item.Cause);\r\n    }\r\n    $scope.ICauses = $scope.itemsCauseStr.toString();\r\n    //alert($scope.ICauses);\r\n  };\r\n  $scope.SettingStr = \"\";\r\n  $scope.setSetting = function () {\r\n    var isNan4Long = false;\r\n    var isNan4Width = false;\r\n    var isNan4Height = false;\r\n    var isNan4Count = false;\r\n    $scope.isVerification = true;\r\n    var emptyCount = 0;\r\n    var nIdex = 0;\r\n    $scope.SettingStr = $scope.EquipmentName + \"\\n\\r\";\r\n    _($scope.SettingInfo).each(function (item, idx) {\r\n      nIdex = 0;\r\n      if (item.nLong == null || item.nLong == \"\") {\r\n        emptyCount += 1;\r\n      } else if (isNaN(item.nLong)) {\r\n        isNan4Long = true;\r\n      }\r\n      if (item.nWidth == null || item.nWidth == \"\") {\r\n        emptyCount += 1;\r\n      } else if (isNaN(item.nWidth)) {\r\n        isNan4Width = true;\r\n      }\r\n      if (item.nHeight == null || item.nHeight == \"\") {\r\n        emptyCount += 1;\r\n      } else if (isNaN(item.nHeight)) {\r\n        isNan4Height = true;\r\n      }\r\n      if (item.nCount == null || item.nCount == \"\") {\r\n        emptyCount += 1;\r\n      } else if (isNaN(item.nCount)) {\r\n        isNan4Count = true;\r\n      }\r\n      if (emptyCount > 0 && emptyCount < 4) {\r\n        alert('请输入全部尺寸参数！');\r\n        $scope.isVerification = false;\r\n      } else if (emptyCount == 4) {\r\n        if ($scope.SettingInfo.length == 1) {\r\n          alert('必须要有一种尺寸的亚克力板！');\r\n          $scope.isVerification = false;\r\n        } else {\r\n          $scope.SettingInfo.splice(idx, 1);\r\n        }\r\n      } else {\r\n        $scope.SettingStr = $scope.SettingStr + \"\\n\\r 长(\" + item.nLong + \")mmX宽(\" + item.nWidth + \")mmX厚(\" + item.nHeight + \")mmX\" + item.nCount;\r\n      }\r\n    });\r\n    if (isNan4Long) {\r\n      alert('长度必须是数字！');\r\n      return false;\r\n    }\r\n    if (isNan4Width) {\r\n      alert('宽度必须是数字！');\r\n      return false;\r\n    }\r\n    if (isNan4Height) {\r\n      alert('厚度必须是数字！');\r\n      return false;\r\n    }\r\n    if (isNan4Count) {\r\n      alert('数量必须是数字！');\r\n      return false;\r\n    }\r\n    $scope.isShowSetting = true;\r\n    if ($scope.isVerification) {\r\n      $('#equipment_setting').modal('hide');\r\n    }\r\n    // $('#confirmAddSetting').modal('show'); \r\n  };\r\n  $scope.confirmAddSetting = function (nStatus) {\r\n    if (parseInt(nStatus) == 1) {\r\n      $scope.SettingInfo.push({\r\n        \"nCount\": null,\r\n        \"nHeight\": null,\r\n        \"nWidth\": null,\r\n        \"nLong\": null\r\n      });\r\n      $('#confirmAddSetting').modal('hide');\r\n    } else {\r\n      $('#confirmAddSetting').modal('hide');\r\n      $scope.setSetting();\r\n    }\r\n    $scope.showConfirm = false;\r\n    $('#equipment_setting').css({\r\n      \"z-index\": 1050\r\n    });\r\n  };\r\n  $scope.showConfirmModal = function () {\r\n    $scope.showConfirm = true;\r\n    $('#equipment_setting').css({\r\n      \"z-index\": 99\r\n    });\r\n    $('#confirmAddSetting').modal('show');\r\n  };\r\n  $scope.removeItem4Setting = function (idx) {\r\n    if ($scope.SettingInfo.length > 1) {\r\n      $scope.SettingInfo.splice(idx, 1);\r\n    } else {\r\n      alert('必须要有一种尺寸的亚克力板！');\r\n    }\r\n  };\r\n}]);"]}
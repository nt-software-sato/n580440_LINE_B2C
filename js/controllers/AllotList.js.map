{"version":3,"sources":["controllers/AllotList.js"],"names":["WeChat","controller","$scope","$http","$timeout","$cookies","$filter","$sce","$mdSidenav","StoreUser","AppId","ApiMapper","OpenId","window","localStorage","getItem","PageCounts","currentPage","TimesForLock","isLoading","isShowMore","List","Select2Data","Select2Data01","SelectedList01","Select2SelectedList","StoreSelectedList","RequestTime","StartDate","EndDate","RequisitionStatus","ToBeDelivery","AlreadyDelivery","AlreadyAccept","Cancel","SearhParams","StageId","Func_Timeouter_Lock","pageTag","thisStepName","moveTypeName","stepName","stepName4Histories","deliberatelyTrustDangerousSnippet","snippet","trustAsHtml","Search_Time","Tag","cancel","OpenDetail","moveObj","MoveOrder","moveOrder","CurrentStepName","CurrentStep","NextStepShow","isSubmit","i","each","_ItemData","stepId","MoveType","push","moveHist","_","forEach","MoveOrderHistories","item","tlType","tlSubType","Step","open","GetMoveOrderDetail","moveOrderId","sApi","url","method","contentType","headers","Passport","success","res","getQueryString","SetParams","v","parseInt","SearchList","CreatedTime","cache","data","JSON","stringify","isShowDetail","Item","RequisitionId","SourceUnit","Unit","NextStep","isEdit","LoadMore","SetCaseCode","GetStore","Unitdata","StoreList","Item1","Id","UnitId","isSelected","Level1","Level2","UnitLevel","Item2","Text","Item3","Level3","UnitIds","Select2List","toggle","close","then","tag","setTimeout","AlreadyReturn","LoadMnti","n","tabName","tabId","clearSelect2Values4Item","pcompanyList","uniq","loadSelect2Data4Item","Areas","UnitName","toString","EquipmentSelectedList","SelectedList02","SelectedList03","ItemId","length","AddToSelect2","Index","isShowButton","RemoveForSelect2","splice","rSetSelect2Values","Select2Item","ItemObject","SetFiterHighlight","replace","ItemText","indexOf","nTextStr","SetSelect2Values","$","removeClass","clearSelect2Values","resetAllParams","gotoSearch","id","stageId","companyId","MoveOrderId","GetRepairDetail","requisitionId","setItem","$broadcast","RepairInfo","IPositionIds","GetEquipmentpos","EquipmentId","Equipmentpos","filter","PositionId","getHistory","reverse","_TableData","Date","ResponseTime","console","isTimeline","GetUnitInfo","Base64","encode","DeptInfo","GetCheckinHistories","CheckinHistories"],"mappings":"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","file":"AllotList.js","sourcesContent":["'use strict';\r\n\r\nWeChat.controller('AllotListCtrl', ['$scope', '$http', '$timeout', '$cookies', '$filter', '$sce', \"$mdSidenav\", function($scope, $http, $timeout, $cookies, $filter, $sce, $mdSidenav) {\r\n  $scope.StoreUser = $cookies.StoreUser;\r\n  //取得openID\r\n  //流程是AppID(公眾號ID) > codeID(驗證碼) > openID(使用者在這個公眾號的ID) > (API) > 使用者資訊\r\n  $scope.AppId = ApiMapper.AppId;\r\n  $scope.OpenId = window.localStorage.getItem($scope.AppId);\r\n\r\n  $scope.PageCounts = 0;\r\n  $scope.currentPage = 1;\r\n  $scope.TimesForLock = 0;\r\n  $scope.isLoading = true;\r\n  $scope.isShowMore = false;\r\n  $scope.List = [];\r\n  $scope.Select2Data = [];\r\n  $scope.Select2Data01 = [];\r\n  $scope.SelectedList01 = [];\r\n  $scope.Select2SelectedList = [];\r\n  $scope.StoreSelectedList = [];\r\n  $scope.RequestTime = {\r\n    \"StartDate\": null,\r\n    \"EndDate\": null\r\n  };\r\n  $scope.RequisitionStatus = {\r\n    \"ToBeDelivery\": false,\r\n    \"AlreadyDelivery\": false,\r\n    \"AlreadyAccept\": false,\r\n    \"Cancel\": false\r\n  };\r\n  $scope.SearhParams = {\r\n    \"StageId\": [0, 1, 2, 3, 4]\r\n  };\r\n  var pageTag = \"list\";\r\n  var thisStepName = [\"发货\",\"师傅已取件\"];\r\n    var moveTypeName = [\"unknown\", \"设备调拨\", \"返厂维修\"];\r\n    var stepName = [\"待发货\", \"已发货\", \"已收货\", \"已取消\", \"已返还\"];\r\n    var stepName4Histories = [\"申请\", \"发货\", \"收货\", \"取消\", \"返还\"];\r\n  $scope.deliberatelyTrustDangerousSnippet = function(snippet) {\r\n    return $sce.trustAsHtml(snippet);\r\n  };\r\n  var Func_Timeouter_Lock;\r\n  $scope.Search_Time = function(Tag) {\r\n    if ($scope.TimesForLock == 100) { //原本 200\r\n      $timeout.cancel(Func_Timeouter_Lock);\r\n      $scope.TimesForLock = 0;\r\n      $scope.SearchList(1);\r\n    } else {\r\n      $scope.TimesForLock = $scope.TimesForLock + 1;\r\n      Func_Timeouter_Lock = $timeout(function() {\r\n        $scope.Search_Time(Tag);\r\n      }, 1);\r\n    }\r\n  };\r\n\r\n  //调拨单详情\r\n  $scope.OpenDetail = function (moveObj) {\r\n    $scope.moveOrder = moveObj.MoveOrder;\r\n    $scope.moveOrder.CurrentStepName = stepName[moveObj.MoveOrder.CurrentStep];\r\n    $scope.moveOrder.MoveTypeName = moveTypeName[moveObj.MoveOrder.MoveType];\r\n\r\n    //显示按钮\r\n    $scope.moveOrder.NextStepShow = [];\r\n    $scope.moveOrder.isSubmit = false;\r\n    _.each($scope.moveOrder.NextStep, function(i) {\r\n      var _ItemData = {\r\n        \"stepId\": i,\r\n        \"stepName\": \"\"\r\n      };\r\n      if (i === 1) {\r\n        _ItemData.stepName = thisStepName[$scope.moveOrder.MoveType-1];\r\n      } else if (i === 2) {\r\n        _ItemData.stepName = \"收货\";\r\n      } else if (i === 3) {\r\n        _ItemData.stepName = \"取消\";\r\n      }\r\n      $scope.moveOrder.NextStepShow.push(_ItemData);\r\n    });\r\n\r\n    $scope.moveHist = _.forEach(moveObj.MoveOrderHistories, item => {\r\n      item.tlType = \"tl-item\";\r\n      item.tlSubType = \"tl-wrap b-info\";\r\n      item.StepTime = stepName4Histories[item.Step];\r\n    });\r\n    if(pageTag == \"list\"){\r\n      $mdSidenav('MoveDetail').open();\r\n      pageTag = \"detail\";\r\n    }\r\n  };\r\n  //获取调拨单详情\r\n  $scope.GetMoveOrderDetail = function(moveOrderId){\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/moveOder/detail/' + moveOrderId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function(res) {      \r\n      $scope.OpenDetail(res);\r\n    }).error(function(err) {});\r\n  };\r\n  //微信通知打开调拨单详情\r\n  var moveOrderId = getQueryString(\"moveOrderId\");\r\n  if (!!moveOrderId) {\r\n    $scope.GetMoveOrderDetail(moveOrderId);\r\n  }\r\n\r\n  $scope.SetParams = function(v) {\r\n    $scope.SearhParams.StageId = [];\r\n    if (parseInt(v) === 99) {\r\n      $scope.SearhParams.StageId = [0, 1, 2, 3];\r\n    } else {\r\n      $scope.SearhParams.StageId.push(v);\r\n    }\r\n    $scope.SearchList(1);\r\n  };\r\n  $scope.SearchList = function(currentPage) {\r\n    $scope.isShowMore = false;\r\n    if (parseInt(currentPage) > 0) {\r\n      $scope.currentPage = currentPage;\r\n    } else {\r\n      $scope.currentPage = 1;\r\n    }\r\n    //加载更多内容不显示loading动画\r\n    if ($scope.currentPage <= 1) {\r\n      $scope.isLoading = true;\r\n    }\r\n    $scope.SearhParams.RequestTime = [];\r\n    $scope.RequestTime.StartDate == null ? '' : $scope.SearhParams.CreatedTime.push($scope.RequestTime.StartDate);\r\n    $scope.RequestTime.EndDate == null ? '' : $scope.SearhParams.CreatedTime.push($scope.RequestTime.EndDate);\r\n\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/moveOder/search/' + $scope.currentPage,\r\n      method: 'POST',\r\n      cache: false,\r\n      contentType: 'application/json',\r\n      headers: {\r\n        Passport: $cookies.Passport\r\n      },\r\n      data: JSON.stringify($scope.SearhParams)\r\n    }).success(function(res) {\r\n      if ($scope.currentPage == 1) {\r\n        $scope.List = [];\r\n      }\r\n\r\n      if (res[2] > 0) {\r\n        $scope.isShowDetail = true;\r\n        $scope.PageCounts = parseInt(res[0]);\r\n        $scope.isShowMore = $scope.PageCounts > 1 ? true : false;\r\n        if ($scope.currentPage == $scope.PageCounts) {\r\n          $scope.isShowMore = false;\r\n        } else {\r\n          $scope.isShowMore = true;\r\n        }\r\n      _.each(res[1],function(Item) {\r\n        //显示按钮\r\n        Item.MoveOrder.NextStepShow = [];\r\n        Item.MoveOrder.isSubmit = false;\r\n\r\n        if (Item.MoveOrder.RequisitionId == null || Item.MoveOrder.RequisitionId == \"\") {\r\n          Item.MoveOrder.isLinkRepair = false;\r\n        } else {\r\n          //判断当前人员是否为报修单位人员\r\n          if ((Item.MoveOrder.SourceUnit == $cookies.Unit && $cookies.StoreUser == 1) || $cookies.StoreUser == 0) {\r\n            Item.MoveOrder.isLinkRepair = true;\r\n          }\r\n        }\r\n        _.each(Item.MoveOrder.NextStep, function(i) {\r\n          var _ItemData = {\r\n            \"stepId\": i,\r\n            \"stepName\": \"\"\r\n          };\r\n          if (i === 1) {\r\n            _ItemData.stepName = thisStepName[Item.MoveOrder.MoveType-1];\r\n          } else if (i === 2) {\r\n            _ItemData.stepName = \"收货\";\r\n          } else if (i === 3) {\r\n            _ItemData.stepName = \"取消\";\r\n          }\r\n          Item.MoveOrder.NextStepShow.push(_ItemData);\r\n        });\r\n        //是否显示发货，取消按钮                \r\n        Item.MoveOrder.isEdit = true;\r\n        if (Item.MoveOrder.CurrentStep == 0) {\r\n          Item.MoveOrder.isEdit = true;\r\n          Item.MoveOrder.CurrentStepName = \"待发货\";\r\n        } else if (Item.MoveOrder.CurrentStep == 1) {\r\n          Item.MoveOrder.isEdit = true;\r\n          Item.MoveOrder.CurrentStepName = \"已发货\";\r\n        } else if (Item.MoveOrder.CurrentStep == 2) {\r\n          Item.MoveOrder.isEdit = false;\r\n          Item.MoveOrder.CurrentStepName = \"已收货\";\r\n        } else if (Item.MoveOrder.CurrentStep == 3) {\r\n          Item.MoveOrder.isEdit = false;\r\n          Item.MoveOrder.CurrentStepName = \"已取消\";\r\n        }\r\n        $scope.List.push(Item);\r\n      });\r\n        // Array.prototype.push.apply($scope.List, res[1]);\r\n      } else {\r\n        $scope.isShowDetail = false;\r\n        $scope.isShowMore = false;\r\n      }\r\n      $scope.isLoading = false;\r\n    }).error(function() {\r\n      $scope.isLoading = false;\r\n    });\r\n  };\r\n\r\n  //加载更多\r\n  $scope.LoadMore = function() {\r\n    $scope.currentPage = $scope.currentPage + 1;\r\n    $scope.SearchList($scope.currentPage);\r\n    if ($scope.currentPage == $scope.PageCounts) {\r\n      $scope.isShowMore = false;\r\n    }\r\n  };\r\n  //保修单号查询\r\n  $scope.SetCaseCode = function() {\r\n    $timeout.cancel(Func_Timeouter_Lock);\r\n    $timeout(function() {\r\n      $scope.TimesForLock = 0;\r\n      $scope.Search_Time('S');\r\n    }, 100);\r\n  };\r\n  $scope.SearchList(1);\r\n\r\n  /**/\r\n  //取得門店資料\r\n  $scope.GetStore = function() {\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/unit/maps',\r\n      method: 'GET',\r\n      cache: false,\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function(Unitdata) {\r\n      $scope.StoreList = [];\r\n      $scope.Unitdata = Unitdata;\r\n      _($scope.Unitdata[1]).each(function(Item1) { // + '[' + Item1.UnitId + ']'\r\n        $scope.StoreList.push({\r\n          'Id': Item1.UnitId,\r\n          'Text': Item1.Unit,\r\n          'isSelected': false,\r\n          'Level1': '',\r\n          'Level2': '',\r\n          'UnitLevel': 10\r\n        });\r\n        _($scope.Unitdata[2]).each(function(Item2) {\r\n          if (Item2.Level2 == Item1.UnitId) { //+ '[' + Item2.UnitId + ']'\r\n            $scope.StoreList.push({\r\n              'Id': Item2.UnitId,\r\n              'Text': '　' + Item2.Unit,\r\n              'isSelected': false,\r\n              'Level1': '',\r\n              'Level2': '',\r\n              'UnitLevel': 20\r\n            });\r\n            _($scope.Unitdata[3]).each(function(Item3) {\r\n              if (Item3.Level3 == Item2.UnitId) { //+ '[' + Item3.UnitId + ']'\r\n                $scope.StoreList.push({\r\n                  'Id': Item3.UnitId,\r\n                  'Text': '　　' + Item3.Unit,\r\n                  'isSelected': false,\r\n                  'Level1': Item1.UnitId,\r\n                  'Level2': Item2.UnitId,\r\n                  'UnitLevel': 100\r\n                });\r\n              }\r\n              if (Item3.UnitId == $cookies.UnitId) {\r\n                $scope.SearhParams.UnitIds.push(Item3.UnitId);\r\n                $scope.UnitIds.push(Item3.UnitId);\r\n                $scope.Unit = Item3.Unit;\r\n                $scope.Select2List = [{\r\n                  \"Id\": Item3.UnitId,\r\n                  \"Text\": Item3.Unit\r\n                }];\r\n                $scope.StoreSelectedList = $scope.Select2List;\r\n                $scope.SelectedList01 = $scope.Select2List;\r\n              }\r\n            });\r\n          }\r\n        });\r\n        //$scope.StoreList.push(ParentItem); \r\n      });\r\n      $scope.Select2Data01 = $scope.StoreList;\r\n    });\r\n  };\r\n\r\n  $scope.openFilterRight = function() {\r\n    $mdSidenav(\"FilterRight\").toggle();\r\n    $scope.GetStore();\r\n  };\r\n\r\n  $scope.closeDenav = function(navID) {\r\n    $mdSidenav(navID).close().then(function() {\r\n      $mdSidenav('MoveDetail').close().then(function(){\r\n        pageTag = \"list\";\r\n      });\r\n    });\r\n  };\r\n  $scope.SetParams = function(tag) {\r\n    $scope.RequisitionStatus[tag] = !$scope.RequisitionStatus[tag];\r\n    $scope.SearhParams.StageId = [];\r\n    setTimeout(function() {\r\n      if ($scope.RequisitionStatus.ToBeDelivery) {\r\n        $scope.SearhParams.StageId.push(0);\r\n      }\r\n      if ($scope.RequisitionStatus.AlreadyDelivery) {\r\n        $scope.SearhParams.StageId.push(1);\r\n      }\r\n      if ($scope.RequisitionStatus.AlreadyAccept) {\r\n        $scope.SearhParams.StageId.push(2);\r\n      }\r\n      if ($scope.RequisitionStatus.Cancel) {\r\n        $scope.SearhParams.StageId.push(3);\r\n      }\r\n      if ($scope.RequisitionStatus.AlreadyReturn) {\r\n        $scope.SearhParams.StageId.push(4);\r\n      }\r\n    }, 100);\r\n  };\r\n\r\n  //加载进阶选择页签于资料\r\n  $scope.LoadMnti = function(n) {\r\n    $scope.tabName = \"单位\";\r\n    $scope.tabId = \"Store\";\r\n    $scope.Select2Data = $scope.StoreList;\r\n    if ($scope.SelectedList01.length > 0) {\r\n      $scope.Select2List = $scope.SelectedList01;\r\n    } else {\r\n      $scope.Select2List = [{\r\n        \"Id\": \"\",\r\n        \"Text\": \"\"\r\n      }];\r\n    }\r\n  };\r\n\r\n  //清除所有选择\r\n  $scope.clearSelect2Values4Item = function() {\r\n    //$(\".NT_side_footer\").removeClass('unfixed');\r\n    _($scope.Select2List).each(function(Item, n) {\r\n      Item.Id = \"\";\r\n      Item.Text = \"\";\r\n    });\r\n    _($scope.Select2Data).each(function(Item) {\r\n      Item.isSelected = false;\r\n    });\r\n    if ($scope.tabId == \"Store\") {\r\n      $scope.StoreList = $scope.Select2Data;\r\n    } else if ($scope.tabId == \"Maintainer\") {\r\n      $scope.pcompanyList = $scope.Select2Data;\r\n    } else {\r\n      $scope.EquipmentList = $scope.Select2Data;\r\n    }\r\n  };\r\n  //获取下层资料\r\n  $scope.loadSelect2Data4Item = function() {\r\n    if ($scope.tabId == \"Store\") {\r\n      $scope.StoreSelectedList = _.uniq($scope.SelectedList01);\r\n      $scope.UnitIds = [];\r\n      var UnitName = [];\r\n      _($scope.StoreSelectedList).each(function(Item) {\r\n        UnitName.push(Item.Text);\r\n        _($scope.Select2Data01).each(function(Areas) {\r\n          if (Areas.Id == Item.Id || Item.Id == Areas.Level1 || Item.Id == Areas.Level2) {\r\n            $scope.UnitIds.push(Areas.Id);\r\n          }\r\n        });\r\n        $scope.UnitIds.push(Item.Id);\r\n      });\r\n\r\n      $scope.Unit = UnitName.toString();\r\n      $scope.MaintainerSelectedList = [];\r\n      $scope.EquipmentSelectedList = [];\r\n    } else if ($scope.tabId == \"Maintainer\") {\r\n      $scope.MaintainerSelectedList = $scope.SelectedList02;\r\n    } else {\r\n      $scope.EquipmentSelectedList = $scope.SelectedList03;\r\n    }\r\n  };\r\n  //禁用按钮\r\n  $scope.isShowButton = function(Tag, n) {\r\n    var ItemId = $scope.Select2List[n].Id;\r\n    if (Tag == \"ADD\") {\r\n      if (ItemId == \"\") {\r\n        return true;\r\n      } else if (n == 0 && $scope.Select2List.length > 1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } else {\r\n      if (n == 0 && $scope.Select2List.length == 1 && (ItemId == \"\" || ItemId == null)) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  };\r\n  //新增报修项目\r\n  $scope.AddToSelect2 = function(Index) {\r\n    if (!$scope.isShowButton('ADD', Index)) {\r\n      $scope.Select2List.push({\r\n        'Id': '',\r\n        'text': ''\r\n      });\r\n    }\r\n  };\r\n  //删除报修项目\r\n  $scope.RemoveForSelect2 = function(Index) {\r\n    if (!$scope.isShowButton('Delete', Index)) {\r\n      if ($scope.Select2List.length > 1) {\r\n        $scope.Select2List.splice(Index, 1);\r\n      } else {\r\n        $scope.Select2List = [{\r\n          \"Id\": \"\",\r\n          \"Text\": \"\"\r\n        }];\r\n        $scope.Select2Data01 = [];\r\n        $scope.SelectedList01 = [];\r\n      }\r\n    }\r\n  };\r\n  //文本框获取焦点\r\n  $scope.rSetSelect2Values = function(Item) {\r\n    Item.isSelected = false;\r\n    Item.Text = \"\";\r\n    Item.Id = \"\";\r\n  };\r\n  //文本关键字查询--高亮\r\n  $scope.SetFiterHighlight = function(Select2Item) {\r\n    $scope.Select2Data = [];\r\n    _($scope.StoreList).each(function(Item) {\r\n      var ItemObject = Item;\r\n      var ItemText = Item.Text;\r\n      ItemText = ItemText.replace(\"<span style='color:red;'>\", \"\");\r\n      Item.Text = ItemText.replace(\"</span>\", \"\");\r\n      if (Select2Item.Text != \"\" && ItemText.indexOf(Select2Item.Text) >= 0) {\r\n        var nTextStr = \"<span style='color:red;'>\" + Select2Item.Text + \"</span>\";\r\n        ItemObject.Text = ItemText.replace(Select2Item.Text, nTextStr);\r\n        $scope.Select2Data.push({\r\n          'Id': Item.Id,\r\n          'Text': ItemText.replace(Select2Item.Text, nTextStr)\r\n        });\r\n\r\n        ItemText = ItemText.replace(\"<span style='color:red;'>\", \"\");\r\n        Item.Text = ItemText.replace(\"</span>\", \"\");\r\n      }\r\n    });\r\n  };\r\n  //设定Select2选中值\r\n  $scope.SetSelect2Values = function(Item, n) {\r\n    $(\".NT_side_footer\").removeClass('unfixed');\r\n    Item.isSelected = !Item.isSelected;\r\n    var ItemText = $scope.Select2Data[n].Text;\r\n    ItemText = ItemText.replace(\"　\", \"\");\r\n    ItemText = ItemText.replace(\"　\", \"\");\r\n    ItemText = ItemText.replace(\"<span style='color:red;'>\", \"\");\r\n    ItemText = ItemText.replace(\"</span>\", \"\");\r\n    Item.Text = ItemText;\r\n    Item.Id = $scope.Select2Data[n].Id;\r\n\r\n    $timeout(function() {\r\n      $scope.Select2Data01 = $scope.Select2Data;\r\n      $scope.SelectedList01 = _.uniq($scope.Select2List);\r\n    }, 300);\r\n  };\r\n\r\n  var resetAllParams = function() {\r\n    $scope.RequestTime = {\r\n      \"StartDate\": null,\r\n      \"EndDate\": null\r\n    };\r\n\r\n    $scope.RequisitionStatus = {\r\n      \"ToBeDelivery\": false,\r\n      \"AlreadyDelivery\": false,\r\n      \"AlreadyAccept\": false,\r\n      \"Cancel\": false\r\n    };\r\n\r\n    $scope.SearhParams = {\r\n      \"StageId\": [0, 1, 2, 3]\r\n    };\r\n  };\r\n  //清除所有选择\r\n  $scope.clearSelect2Values = function() {\r\n    resetAllParams();\r\n    $scope.Select2Data01 = $scope.StoreList;\r\n\r\n    $scope.StoreSelectedList = [];\r\n    _($scope.Select2List).each(function(Item, n) {\r\n      Item.Id = \"\";\r\n      Item.Text = \"\";\r\n    });\r\n    _($scope.Select2Data01).each(function(Item) {\r\n      Item.isSelected = false;\r\n    });\r\n    _($scope.SelectedList01).each(function(Item) {\r\n      Item.isSelected = false;\r\n    });\r\n    $scope.Unit = \"\";\r\n    $scope.closeDenav('FilterRight');\r\n    $scope.SearchList($scope.currentPage);\r\n  };\r\n  //确认查询\r\n  $scope.gotoSearch = function() {\r\n    //$scope.StoreList = $scope.Select2Data01;\r\n    //$scope.pcompanyList = $scope.Select2Data02;\r\n    //$scope.EquipmentList = $scope.Select2Data03;\r\n    $scope.SearhParams.UnitIds = [];\r\n    var UnitName = [];\r\n    _($scope.StoreSelectedList).each(function(Item) {\r\n      UnitName.push(Item.Text);\r\n      _($scope.StoreList).each(function(Areas) {\r\n        if (Areas.Id == Item.Id || Item.Id == Areas.Level1 || Item.Id == Areas.Level2) {\r\n          $scope.SearhParams.UnitIds.push(Areas.Id);\r\n        }\r\n      });\r\n      $scope.SearhParams.UnitIds.push(Item.Id);\r\n    });\r\n    $scope.Unit = UnitName.toString();\r\n\r\n    $scope.closeDenav('FilterRight');\r\n    $scope.SearchList($scope.currentPage);\r\n  };\r\n  //新增调拨进度\r\n  $scope.addHistory4Allot = function(id, stageId, companyId) {\r\n    var paramsStr = {\r\n      \"MoveOrderId\": id,\r\n      \"StageId\": stageId\r\n    };\r\n\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/moveOder/history/create',\r\n      method: 'POST',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      data: paramsStr\r\n    }).success(function(data) {\r\n      if(pageTag == \"detail\"){\r\n        $scope.GetMoveOrderDetail(id);\r\n      }\r\n      $scope.SearchList($scope.currentPage);\r\n    })\r\n    .error(function(data) {\r\n      $scope.isSubmit = false;\r\n      alert(data.Messages);\r\n    });\r\n  };\r\n  //相关报修单详情\r\n\r\n  //加载案件详情\r\n  $scope.GetRepairDetail = function (requisitionId) {\r\n    window.localStorage.setItem(\"DetailId\", requisitionId);\r\n    $scope.$broadcast(\"RepairList2Detail\", requisitionId);\r\n    $mdSidenav('RepairDetail').toggle();\r\n    $scope.RepairInfo = {};\r\n  };\r\n  //获取区域(案件详情)\r\n  $scope.GetEquipmentpos = function () {\r\n    if ($scope.RepairInfo.IPositionIds != null) {\r\n      var IPositionIds = $scope.RepairInfo.IPositionIds;\r\n      if (IPositionIds != '') {\r\n        $http({\r\n          url: ApiMapper.sApi + '/s/equipmentpos/' + $scope.RepairInfo.EquipmentId,\r\n          method: 'GET',\r\n          contentType: 'application/json',\r\n          headers: {\r\n            'Passport': $cookies.Passport\r\n          },\r\n          cache: false\r\n        }).success(function (data) {\r\n          $scope.Equipmentpos = _(data).filter(function (Item) {\r\n            return IPositionIds.indexOf(Item.PositionId) >= 0;\r\n          });\r\n        });\r\n      }\r\n    }\r\n  };\r\n  //获取报修进度列表\r\n  $scope.getHistory = function () {\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/rez/history/' + $scope.RepairInfo.RequisitionId,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function (data) {\r\n      if (data.length > 0) {\r\n        data = data.reverse();\r\n        $scope._TableData = data;\r\n        _($scope._TableData).each(function (Item) {\r\n          Item.ResponseTime = $filter('date')(new Date(Item.ResponseTime), 'yyyy/MM/dd HH:mm:ss');\r\n        });\r\n        if ($scope._TableData.length > 0) {\r\n          $scope.isTimeline = true;\r\n        }\r\n        console.log('值為');\r\n        console.log($scope._TableData);\r\n      }\r\n    });\r\n  };\r\n  //获取单位信息\r\n  $scope.GetUnitInfo = function () {\r\n    //获取部门信息\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/unit/' + Base64.encode($scope.RepairInfo.UnitId),\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      },\r\n      cache: false\r\n    }).success(function (data) {\r\n      $scope.DeptInfo = data;\r\n    });\r\n  };\r\n  //获取打卡历程\r\n  $scope.GetCheckinHistories = function (Id) {\r\n    $http({\r\n      url: ApiMapper.sApi + '/s/checkin/' + Id,\r\n      method: 'GET',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'Passport': $cookies.Passport\r\n      }\r\n    }).success(function (data) {\r\n      $scope.RepairInfo.CheckinHistories = [];\r\n      _(data).each(function (Item) {\r\n        Item.Selected = false;\r\n      });\r\n      $scope.RepairInfo.CheckinHistories = data;\r\n    });\r\n  };\r\n}]);"]}
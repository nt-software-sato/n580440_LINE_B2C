{"version":3,"sources":["controllers/Transfer.js"],"names":["WeChat","controller","$scope","$http","$cookies","$timeout","$mdSidenav","$mdUtil","$cacheFactory","i18n","UserId","UnitId","Unit","Passport","StoreUser","AppId","window","ChangeTag","QRCodeStr","supportInfo","supportShow","SupportList","UnitInfo","PassCode","ViewObj","parseInt","FormatDATE","date","myDate","Date","getFullYear","_YY","getMonth","getDate","getHours","getMinutes","_MM","_DD","GetNow","ValidtorTime","dt1","dt2","d1","getTime","Load_WX","wx","config","debug","appId","timestamp","localStorage","getItem","nonceStr","jsApiList","res","error","ApiMapper","url","method","cache","data","contentType","success","ticket","location","href","setItem","String1","ready","loadQRcode","sApi","QRCodeUri","ToscanQRCode","needResult","scanQRCode","scanType","resultStr","encodeURIComponent","UnitName","getSupportInfo","length","Item","StartTime","EndTime","each","push","alert","Messages","isSubmit","TransferSubmit","ApiStr","PostParames","alertStr","toUpperCase","val","$","Info","StatusCode","confirm","closeWindow","$modal","$mdDialog","CompanyId","OpenId","EquipmentName","OpenModalTag","MoveOrderParameters","MoveType","IsMove","IsClose","SourceId","Source","TargetId","Target","Remark","EquipmentId","EquipmentList","ClassName","children","EquipmentTypeClass","StoreList","IsShowToScanQRCode","IsShowAddCause","IsWPStylePriorityList","Client_Permissions","indexOf","GetStore","headers","Unitdata","_","Item1","UnitLeve4data","isSelected","Item2","Level2Name","GetEquipment","status","parameterStr","TopicType","Maintenance","GetFacilities","JSON","stringify","Items","Lists","EquipmentTypeName","EquipmentCode","SortNo","equipmentType","index","ShowArea","Equipment","PositionByTypeEquipmentTypeName","isWPStoreUser","isShowArea","isSelectLeve2","UnitItem","AreaIds","UnitLeve3data","filter","isSelectLeve3","reLoadLeve4","ProvinceIds","Level2","isSelectLeve4","console","log","navID","toggleRight","open","closeDenav","close","EQ_close","e","then"],"mappings":"aAAAA,OAAOC,WAAW,eAAgB,CAAC,SAAU,QAAS,WAAY,WAAY,aAAc,UAAW,gBAAiB,OAAQ,SAASC,EAAQC,EAAOC,EAAUC,EAAUC,EAAYC,EAASC,EAAeC,GAC9MP,EAAOQ,OAASN,EAASM,OAD3BV,EAAOC,OAAWG,EAAAO,OAChBT,EAAOQ,KAAPN,EAAgBA,KAChBF,EAAOS,UAASP,EAASO,UACzBT,EAAOU,SAAOR,EAAdS,SACAX,EAAOY,MAAAA,OAAYV,aAASU,QAA5B,aACAZ,EAAOW,UAAWT,EAClBF,EAAOa,UAAQC,GACfd,EAAOe,YAAP,GACAf,EAAOgB,aAAP,EACAhB,EAAOiB,YAAc,GACrBjB,EAAOkB,SAAP,CACAlB,KAAOmB,GACPnB,OAAOoB,GACLC,SADgB,IAGhBrB,EAAAsB,QAAY,CAHdN,UAAA,GAKAhB,UAAA,GAAA,GAAAuB,SAAAvB,EAAAY,aAMIZ,EAAOsB,QAAQP,UAAY,GAC5Bf,EAAAwB,WAAA,SAAAC,GACH,IAAAC,EAAA,IAAAC,KAAAF,GACAzB,EAAOwB,EAAPI,cACMF,EAAAA,EAAaC,WAAjB,EACIE,EAAMH,EAAOE,UACPF,EAAOI,WACPJ,EAAOK,aACPL,EAAOM,aAEjB,OADUN,EAAOO,IAAPC,EAAV,IAAAC,GAIDnC,EAVDoC,OAAA,WAWA,IAAAV,EAAA,IAAAC,KACA3B,EAAOoC,EAASR,cACVF,EAAAA,EAAaC,WAAjB,EACIE,EAAMH,EAAOE,UACPF,EAAOI,WACPJ,EAAOK,aACPL,EAAOM,aAEjB,OADUN,EAAOO,IAAPC,EAAV,IAAAC,GAIDnC,EAVDqC,aAAA,SAAAC,EAAAC,GAWA,IAAAC,EAAA,IAAAb,KAAAW,GAAAG,UAEE,QADKJ,IAAAA,KAAPE,GAAsBE,WAChBD,IAMLxC,EAPD0C,QAAA,WAQAC,GAAAC,OAAA,CACA5C,OAAO0C,EACLC,MAAA3C,EAAUa,MACRgC,UAAO,WACPC,SAAO9C,UACP+C,UAAWjC,OAAAkC,aAHHC,QAAAjD,EAAAa,MAAA,cAIRqC,UAAU,CAAA,aAJF,sBAAA,wBAAA,gBAAA,mBAAA,gBAAA,gBAAA,yBAAA,yBAAA,iBAAA,cAAA,aAAA,cAAA,YAAA,aAAA,YAAA,cAAA,gBAAA,cAAA,eAAA,cAAA,gBAAA,iBAAA,eAAA,cAAA,iBAAA,iBAAA,cAAA,aAAA,cAAA,0BAAA,UAAA,aAAA,cAMRC,GAAAA,MAAAA,SAAYC,GANdnD,EAAA,CAQGoD,IAAMC,UAASF,MAAK,gBAAApD,EAAAa,MACrBZ,OAAM,MACJsD,OAAKD,EACLE,YAFI,qBAGJC,QAAO,SAHHC,GAIJC,IAAAA,EAAaD,EAJf5C,OAKG8C,aAAiBF,QAAM1D,EAAAa,MAAA,UAAAgD,GACxB,IAAIA,EAASH,gBAAbG,EAAA,8CAAA/C,OAAAgD,SAAAC,KACAjD,OAAOkC,aAAagB,QAAQhE,EAAOa,MAAQ,aAAWgD,SAAtDI,IACAjE,EAAIiE,eAIPjE,EAbD0C,UAcDC,GAvBDuB,MAAA,WAyBoB,GAAjBA,SAAMlE,EAAWY,aAClBZ,EAAAe,UAAA,KAMDf,EAPDmE,WAAA,WAQAlE,EAAA,CACAD,IAAOmE,UAAPC,KAAoB,uBAAWpE,EAAAS,OAC7BR,YAAM,mBACJsD,QAAKD,CACLK,SAAazD,EAAAS,UAEX6C,OAAA,QAJEI,QAAA,SAAAF,GAMJF,EAAAA,QAAQa,UAAAX,IACPE,MAAAA,SAAQF,GACT1D,MAAAA,EAAOsB,aAGRtB,EAXDmE,aAaFnE,EAAOmE,aAAP,WAEAnE,GAAAA,WAAOsE,CACLC,WAAA,EACA5B,SAAG6B,CAAH,SAAc,WACZD,QAAAA,SAAenB,GACfqB,EAAAA,UAAqBrB,EAAAsB,UAEnB1E,EAAAA,CACAuD,IAAAD,UAAAc,KAAA,gCAAAO,mBAAA3E,EAAAgB,WACAf,YAAM,mBACJsD,QAAKD,CACLK,SAAazD,EAAAS,UAEX6C,OAAA,QAJEI,QAAA,SAAAF,GAMJF,EAAAA,SAAQ9C,KAAAgD,EAAAkB,SANV5E,EAOG4D,SAAQnD,OAAeiD,EAAAjD,OACxBT,EAAOoB,SAASV,SAAOgD,EAAKkB,WAC5B5E,MAAOoB,SAASX,GAChBT,MAAAA,EAAOoB,gBAMdpB,EAxBD6E,eAAA,WAyBA5E,EAAA,CACAD,IAAO6E,UAAAA,KAAiB,mBAAW7E,EAAAQ,OACjCP,OAAM,MACJsD,YAAKD,mBACLE,QAAQ,CACRG,SAAa3D,EAAAW,YAEXiD,QAAA,SAAY5D,GADL,EAAA0D,EAAAoB,QAGRlB,EAAAA,KAAQF,EAAA,SAAAqB,GACAD,EAALzC,aAAiBrC,EAAAoC,SAAA2C,EAAAC,YAAAhF,EAAAqC,aAAA0C,EAAAE,QAAAjF,EAAAoC,YACjB8C,EAAKxB,UAAM1D,EAAAwB,WAAeuD,EAAAC,WAC1BD,EAAK/E,QAAOqC,EAAPb,WAA2BY,EAA3B6C,SACHF,EAAKC,YAAYhF,EACjB+E,EAAKE,aAAUjF,EACfA,EAAOiB,YAAPkE,KAAqBJ,QAIxB1B,MARD,SAAAK,GASD0B,MAAA1B,EAAA2B,aAGFrF,EArBD6E,iBAuBF7E,EAAO6E,eAAP,WAKuB,GAJvB7E,EAAAsF,UAAA,EACAtF,EAAOuF,OAAAA,UAAiBnB,KAAA,oBAAWpE,EAAAQ,OACjCR,EAAOsF,YAAW,CAClBtF,OAAOwF,EACPxF,OAAOyF,EAAPrE,SAAqBX,OACnBY,SADmBrB,EAAAoB,SAAAC,UAGnBrB,EAAA0F,SAAY1F,QAHdA,EAAAoB,SAAAX,OAAAkF,eAAA3F,EAAAS,OAAAkF,cAKA3F,OAAA,GAAAA,SAAAA,EAAkBe,YACdf,EAAOoB,UAASX,EAClB2E,MAAI7D,wBAGFvB,EAAOsF,UAAP,EAHFF,MAIO,wBAHEE,EAOR,GAAA,GAAA/D,SAAAvB,EAAAe,WAAA,CAKDf,GAJDA,EAAAwF,OAAAlC,UAAAc,KAAA,mBAAApE,EAAAQ,OACDR,EAAIuB,SAAgBR,UAClBf,EAAOwF,UAASlC,EAAAA,cAAiBsC,MACjC5F,EAAO0F,QAAPG,EAAkB,YAAlBD,MACqB,IAArB5F,EAAOgF,WAAP,IAAqBhF,EAAc4F,QAGjC5F,OAFFA,EAAOiF,UAAY,EACnBG,MAAIpF,eACKsF,EACPF,GAAMpF,EAAAqC,aAANrC,EAAAwB,WAAAxB,EAAAiF,SAAAjF,EAAAwB,WAAAxB,EAAAgF,YAGAhF,OAFAA,EAAOsF,UAAP,EAHFF,MAIO,kBACEE,EACPF,GAAMpF,EAAAqC,aAANrC,EAAAwB,WAAAxB,EAAAiF,SAAAjF,EAAAoC,UAGApC,OAFAA,EAAOsF,UAAP,EAHKF,MAIA,iBACEE,EAEPtF,EAAOyF,YAAP,CAHKK,KAIA,CACL9F,OAAOyF,EACLhF,OAAQT,EAAAoB,SAAAX,OACNC,KAAAV,EADMoB,SAAAV,KAENsE,UAAUhF,EAAOoB,UACjB6D,QAAQjF,EAAOoB,SAEfC,SAAArB,EAAWA,SAAOiF,UAIvB,IAAAjF,EAAAoB,SAAAV,KACFT,EAAA,CACGD,IAAAA,UAAAoE,KAAA,WAA4BpE,EAAAoB,SAAAX,OAC9BR,YAAM,mBACJsD,QAAKD,CACLK,SAAazD,EAAAS,UAEX6C,OAAA,QAJEI,QAAA,SAAAF,GAMI,QAARF,EAAQuC,YAAA,MAAArC,EAAAqC,YACPnC,EAAQ0B,UAAS5B,EAClB0B,MAAI1B,mBAEF0B,EAAMhE,SAAAV,KAANgD,EAAAhD,KAFFsF,QAGOhG,EAAA0F,SAAA,IAAA1F,EAAAoB,SAAAV,KAAA,KACLV,EAAOoB,CACH4E,IAAAA,EAAQhG,OACVC,OAAM,QACJsD,YAAYiC,mBACZhC,QAAQ,CACRG,SAAa3D,EAAAW,UAEX+C,KAAA1D,EAAAyF,cALE7B,QAAA,SAAAF,GAQK,GAARE,EAAQmC,YAAe,GAAAxE,SAAAvB,EAAAe,YACxBqE,MAAA,QAAApF,EAAAoB,SAAAV,KAAA,QACAiC,GAAIe,eACqBtC,GAAjBsC,EAAAqC,YAAN,GAAgCrF,SAAOV,EAAvCe,YACA4B,MAAGsD,SAAHjG,EAAAoB,SAAAV,KAAA,MAFFiC,GAAAsD,gBAKEtD,EAAGsD,UAAH,EAFKb,MAGA1B,EAAA2B,aAELD,MAAAA,SAAWC,GACZrF,EAAAsF,UAAA,EAnBHF,MAAA1B,EAoBS2B,aAGRrF,EAvBDoB,SAAAV,KAAA,GADFV,EAyBOsF,UAAA,MAGNjC,MAAA,SAAAK,GACF1D,EAAAsF,UAAA,EA1CHF,MAAA,kBAAAY,QAAAhG,EAAA0F,SAAA,IAAA1F,EAAAoB,SAAAV,KAAA,KADFT,EAgDO,CACD+F,IAAAA,EAAQhG,OACVC,OAAM,QACJsD,YAAYiC,mBACZhC,QAAQ,CACRG,SAAa3D,EAAAW,UAEX+C,KAAA1D,EAAAyF,cALE7B,QAAA,SAAAF,GAQK,GAARE,EAAQmC,YAAe,GAAAxE,SAAAvB,EAAAe,YACxBqE,MAAA,QAAApF,EAAAoB,SAAAV,KAAA,QACAiC,GAAIe,eACqBtC,GAAjBsC,EAAAqC,YAAN,GAAgCrF,SAAOV,EAAvCe,YACA4B,MAAGsD,SAAHjG,EAAAoB,SAAAV,KAAA,MAFFiC,GAAAsD,gBAKEtD,EAAGsD,UAAH,EAFKb,MAGA1B,EAAA2B,aAELD,MAAAA,SAAWC,GACZrF,EAAAsF,UAAA,EAnBHF,MAAA1B,EAoBS2B,aAGRrF,EAvBDoB,SAAAV,KAAA,GADFV,EAyBOsF,UAAA,OAKVvF,WAjID,eAAA,CAAA,SAAA,QAAA,WAAA,WAAA,aAAA,SAAA,YAAA,OAAA,SAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA8F,EAAAC,EAAA5F,GAjKFP,EAoSCD,UAAWG,EApSZU,UAqSEZ,EAAOY,UAAYV,EAASU,UAC5BZ,EAAOoG,UAAYlG,EAASkG,UAC5BpG,EAAOY,KAAAA,EAAYV,KACnBF,EAAOU,YAAOR,EAGdF,EAAAa,MAAAyC,UAAAzC,MACAb,EAAOa,OAAQyC,OAAAA,aAAfL,QAAAjD,EAAAa,OACAb,EAAOqG,cAAgBrD,GACvBhD,EAAOsG,aAAP,SACAtG,EAAOuG,oBAAe,CACtBvG,cAAOwG,KACLC,SAAA,EACAC,QAAA,EACAC,SAAU,EACVC,SAAW1G,EAJgBO,OAK3BoG,OAAA3G,EAAYA,KACZ4G,SAAU5G,GACV6G,OAAA,GACAC,OAAU,GACVC,YAT2B,GAU3BX,cAV2B,IAAAtG,EAA7BkH,cAAA,CAAA,CAaAlH,mBAAwB,EACtBmH,UAAA,KACAC,SAAA,IACA,CAHqBC,mBAIpB,EACDF,UAAA,KACAC,SAAA,IACA,CAPqBC,mBAQpB,EACDF,UAAA,KACAC,SAAA,IACA,CAXqBC,mBAYpB,GACDF,UAAA,KACAC,SAAA,KAFCpH,EAZHsH,UAAA,GAiBAtH,EAAOsH,cAAgB,GACvBtH,EAAOkH,UAAAA,EACPlH,EAAOsF,oBAAP,EACAtF,EAAOuH,gBAAAA,EACPvH,EAAOwH,uBAAP,EACAxH,EAAOyH,mBAAAA,EAEP,IAAAC,EAAA,CAAA,uCAAA,uCAAA,uCAAA,uCAAA,yCAC0B,EAAtBA,EAAAA,QAAsBxH,EAAAkG,aAC1BpG,EAAI0H,oBAAA,EACF1H,EAAOuH,gBAAAA,EACPvH,EAAOwH,uBAAP,EAEA,yCAAAtH,EAAAkG,WAAA,yCAAAlG,EAAAkG,YACApG,EAAIE,eAAA,KAIL,EAAAwH,EAAAC,QAAAzH,EAAAkG,aACDpG,EAAI0H,mBAAmBC,GAGvB3H,EAAA4H,SAAA,WACA5H,EAAO4H,CACL3H,IAAMqD,UAAAc,KAAA,eACJb,OAAKD,MACLE,OAAAA,EACAC,YAHI,mBAIJE,QAAAA,CACAkE,SAAS3H,EAAAS,YAAAiD,QAAA,SAAAkE,GALX9H,EAQG4D,SAAQkE,EAETC,EAAA7C,KAAA4C,EAAA,GAAA,SAAAE,GACE9C,EAAK4C,cAAa,GAClB9H,EAAAA,YAAOiI,EACPD,EAAAA,KAAME,EAAN,GAAmB,SAAnBC,GACEjD,EAAK4C,cAAa3C,KAAAgD,GAClBnI,EAAOiI,QAAPD,EAA0BG,SAC1BA,EAAIA,WAAgBH,EAAMvH,KACxB0H,EAAMC,YAAaJ,GAEpBG,EAAA1H,QAAAP,EAAAO,SACDT,EAAImI,oBAAyB1H,SAAQ0H,EAAA1H,OACnCT,EAAOwG,oBAAoBI,OAA3BuB,EAAsCA,KAEtCnI,EAAAqI,aAAAnI,EAAAO,WAGHT,EAZDsH,UAAAnC,KAAA6C,OAHF3E,MAAA,SAAAiF,GAXFlD,MAAA,gBAgCDpF,EAjCD4H,WAmCA5H,EAAAqI,aAAA,SAAA5H,GACAT,IAAAA,EAAA,CACES,OAAI8H,EAAe/B,oBAAAI,SACjB4B,UAAUxI,EACVyI,YAFiBzI,EAAAyI,aAAnB,wCAAAzI,EAAAoG,WAAA,wCAAApG,EAAAoG,WAAA,wCAAApG,EAAAoG,YAKAmC,EAAWnC,UAAa,EACtBmC,EAAAA,cAAaC,GAAb,CACAxI,mBAAA,EACEmH,UAAA,KACAC,SAAA,IAFwBpH,EAA1BkH,cAAA,GAAA,CAKAlH,mBAAA,EACEmH,UAAA,KACAC,SAAA,IAFwBpH,EAA1B0I,iBAMDzI,EAAA,CACDA,IAAMqD,UAAAc,KAAA,8BACJb,OAAKD,OACLE,YAAQ,mBACRG,QAAAA,CACAkE,SAAS3H,EAAAS,UAAA+C,KAJLiF,KAAAC,UAAAL,KAOJ7E,QAAMiF,SAAKC,GAPb5I,EAQG4D,cAAQ,CAAA,CACT5D,mBAAwB,EACtBmH,UAAA,KACAC,SAAA,IACA,CAHqBC,mBAIpB,EACDF,UAAA,KACAC,SAAA,IACA,CAPqBC,mBAQpB,EACDF,UAAA,KACAC,SAAA,IACA,CAXqBC,mBAYpB,GACDF,UAAA,KACAC,SAAA,KAdF,wCAAApH,EAAAoG,WAAA,wCAAApG,EAAAoG,WAAA,wCAAApG,EAAAoG,UAiBApG,EAAIA,cAAA,GAAoBoH,SAAA1D,GAAxBqE,EAAA7C,KAKOxB,EAAA,SAAAmF,GACH3D,IAAFgC,EAAa2B,EAAAzB,SACXW,EAAA7C,KAAIgC,EAAgB2B,SAAMzB,GACxBlC,EAAKgC,kBAAe2B,EAASC,kBAC7BA,IAAAA,EAAMC,EAAoBF,cAAME,MAAAA,KAChCD,EAAIE,OAAAA,SAAgBF,EAAME,IAC1BF,EAAMG,cAAS1H,QAASyH,SAAcE,EAAtCC,GACAnJ,EAAAqH,oBAAsC6B,EAAAA,oBACpClJ,EAAIkJ,cAAc7B,GAAAA,SAAdlC,KAAoC2D,SAK7Cf,EAZD7C,KAAAlF,EAAAkH,cAAA,SAAAnC,GAaEG,EAAKlF,SAAOkH,EAAAA,OAAdnC,EAA6BqC,SAASrC,gBAM5C/E,EAAA0I,cAAA,WACA1I,IAAAA,EAAA,CACES,OAAI8H,EAAe/B,oBAAAI,SACjB4B,UAAUxI,EACVyI,YAFiBzI,EAAAyI,aAAAxI,EAAnB,CAKAA,IAAMqD,UAAAc,KAAA,8BACJb,OAAKD,OACLE,YAAQ,mBACRG,QAAAA,CACAkE,SAAS3H,EAAAS,UAAA+C,KAJLiF,KAAAC,UAAAL,KAOJ7E,QAAMiF,SAAKC,GAPbb,EAQGnE,KAAAA,EAAQ,SAASR,GAChB8B,IAAFgC,EAAqB2B,EAATzB,SACVW,EAAA7C,KAAIgC,EAAgB2B,SAAMzB,GACxBlC,EAAKgC,kBAAe2B,EAASC,kBAC7BA,IAAAA,EAAMC,EAAoBF,cAAME,MAAAA,KAChCD,EAAIE,OAAAA,SAAgBF,EAAME,IAC1BF,EAAMG,cAAS1H,GAASyH,SAAAA,KAAcF,UAM9C9I,EAAAoJ,SAAA,SAAAC,EAAAC,GAEE,OAAAA,GAAAtJ,EAAAuJ,cACAvJ,EAAIsJ,YAAAA,EAAJtJ,EAEOwJ,YAAA,EAENxJ,EAAAwG,oBAAAS,YAAAoC,EAAApC,YACDjH,EAAOwG,oBAAoBS,cAAcoC,EAAUpC,cACnDjH,EAAOwG,WAAAA,OAERxG,EAVDyJ,cAAA,SAAAC,GAWA1J,EAAAA,KAAOyJ,EAAAA,SAAgB,GAAA,SAASC,GAC5BxE,EAAKlF,YAAO8H,EACZ/C,EAAKmD,QAAawB,EAAlBjJ,SACAiJ,EAASjJ,YAAUiJ,EAAnBxB,cAFFwB,EAAAxB,aAMAlI,EAAI0J,QAASxB,CAAAA,EAAYzH,QACvBT,EAAO2J,YAAWD,IAEnB1J,EAAA4J,cAAA7B,EAAA8B,OAAA7J,EAAA8H,SAAA,GAAA,SAAA/C,GACD/E,OAAO4J,EAAAA,QAAgB7B,EAAS/H,UAGjCA,EAdDyJ,cAAA,SAAAC,GAeA1J,EAAAA,KAAOyJ,EAAAA,SAAgB,GAAA,SAASC,GAC5BxE,EAAKlF,YAAO8H,EACZ/C,EAAKmD,QAAawB,EAAlBjJ,SACAiJ,EAASjJ,YAAUiJ,EAAnBxB,cAFFwB,EAAAxB,aAMAlI,EAAI0J,QAASxB,CAAAA,EAAYzH,QACvBT,EAAO2J,YAAWD,IAEnB1J,EAAA4J,cAAA7B,EAAA8B,OAAA7J,EAAA8H,SAAA,GAAA,SAAA/C,GACD/E,OAAO4J,EAAAA,QAAgB7B,EAAS/H,UAGjCA,EAdD8J,cAAA,SAAAJ,GAeA1J,EAAAA,KAAO8J,EAAAA,SAAgB,GAAA,SAASJ,GAC5BxE,EAAKlF,YAAO8H,EACZ/C,EAAKmD,QAAawB,EAAlBjJ,SACAiJ,EAASjJ,YAAUiJ,EAAnBxB,cAFFwB,EAAAxB,aAMAlI,EAAI0J,YAAJ,CAAAA,EAAyBjJ,UAG1BT,EAVD+J,YAAA,WAWA/J,EAAO+J,cAAchC,EAAA8B,OAAW7J,EAAA8H,SAAA,GAAA,SAAA/C,GAC9B/E,OAAgCA,EAAhCA,EAAOiI,YAAkB4B,OACnB7J,EAAOgK,QAAYlF,EAAnBkF,YAA+B,GAE5BjF,EAAAkF,QAAAjK,EAAA2J,QAAA,MAIV3J,EARDkK,cAAA,SAAAR,GAAAS,QAAAC,IAAAV,GASA1J,EAAAA,KAAOkK,EAAAA,cAAgB,SAASR,GAAWS,EAAAA,YAAA,EACzCpF,EAAO/E,QAAOiI,EAAexH,SAC3BsE,EAAKmD,YAALwB,EAAAxB,cAGCwB,EAAAxB,aAJH,UAAAlI,EAAAuG,cAMImD,EAAAA,oBAAqB5C,SAAA4C,EAAAjJ,OAAET,EAAAwG,oBAAAO,OAAA2C,EAAAhJ,OAEvBV,EAAOwG,oBAAoBM,SAAW4C,EAASjJ,OAC/CT,EAAOwG,oBAAoBO,OAAS2C,EAAShJ,KAF/CV,EAGOqI,aAAArI,EAAAwG,oBAAAI,WAEL5G,QAAAA,IAAOwG,EAAAA,uBAGT2D,EAAAA,YAAYnK,SAAOwG,GAhBvB,YAiBGxG,EAAAuG,aAAA8D,IAjBH,WAAAA,EAmBArK,EAAOsK,SAAcC,OAEnBnK,EAAIiK,MAAUE,QAGZnK,EAAAA,WAAA,SAAAiK,GACD,UAAAA,GANHtC,EAAA7C,KAAAlF,EAAAiI,cAAA,SAAAlD,GAQA/E,EAAOwK,YAAa,IAEhBzC,EAAO/H,SAAOiI,SAEb7H,EAFD,MAAAqK,SAOHzK,EATD0K,SAAA,SAAAC,GAaEvK,EAAW,MAAMqK,QAAQG,KAAK,eAA9BxK,EAAAA,gBAAA,WADF,IAAAJ,EAAAwG,oBAAAS,YAMI7B,MAAM,WADRnF,EAAID,CACFoF,IAAM9B,UAANc,KAAA,qBADFZ,OAEO,OACLvD,YAAM,mBACJsD,QAAKD,CACLE,SAFItD,EAAAS,UAIJkH,KAAAA,EAASrB,sBACP5C,QAAA,SAAY1D,GADLF,EAJLsF,UAAA,EAOJ5B,MAAM1D,oBAPRA,EAQG4D,oBAAuB,CACxB5D,cAAkB,KAClBoF,SAAM,EACNpF,SAAOwG,EAAAA,OACLK,OAAA3G,EAAiBQ,KACjBoG,SAAY,GACZC,OAAA,GACAC,OAAU9G,GACVwG,QAAA,EACAC,SAAU,EACVM,YAP2B,GAQ3BX,cAR2B,MAU3BjD,MAAA,SAAAK,GACA1D,EAAAsF,UAAA,EAX2BF,MAA7B1B,EAAA2B","file":"Transfer.js","sourcesContent":["WeChat.controller(\"TransferCtrl\", [\"$scope\", \"$http\", \"$cookies\", \"$timeout\", \"$mdSidenav\", \"$mdUtil\", \"$cacheFactory\", \"i18n\", function($scope, $http, $cookies, $timeout, $mdSidenav, $mdUtil, $cacheFactory, i18n) {\n  $scope.UserId = $cookies.UserId;\n  $scope.UnitId = $cookies.UnitId;\n  $scope.Unit = $cookies.Unit;\n  $scope.StoreUser = $cookies.StoreUser;\n  $scope.Passport = $cookies.Passport;\n  $scope.AppId = window.localStorage.getItem('b2c_appId');\n  $scope.ChangeTag = 0;\n  $scope.QRCodeStr = \"\";\n  $scope.supportInfo = {};\n  $scope.supportShow = false;\n  $scope.SupportList = [];\n  $scope.UnitInfo = {\n    'Unit': '',\n    'UnitId': '',\n    'PassCode': ''\n  };\n  $scope.ViewObj = {\n    \"QRCodeStr\":\"\",\n    \"ChangeTag\": 0\n  }\n\n  if (parseInt($scope.StoreUser) == 0) {\n      $scope.ViewObj.ChangeTag = 2;\n    }\n  //时间格式化\n  $scope.FormatDATE = function(date) {\n    var myDate = new Date(date);\n    var _YY = myDate.getFullYear();\n    var _MM = myDate.getMonth() + 1;\n    var _DD = myDate.getDate();\n    var _hh = myDate.getHours();\n    var _mm = myDate.getMinutes();\n    var _ss = myDate.getSeconds();\n    var _now = '' + _YY + '/' + _MM + '/' + _DD;\n    return _now;\n  };\n  //获取当前时间\n  $scope.GetNow = function() {\n    var myDate = new Date();\n    var _YY = myDate.getFullYear();\n    var _MM = myDate.getMonth() + 1;\n    var _DD = myDate.getDate();\n    var _hh = myDate.getHours();\n    var _mm = myDate.getMinutes();\n    var _ss = myDate.getSeconds();\n    var _now = '' + _YY + '/' + _MM + '/' + _DD;\n    return _now;\n  };\n  //时间比较\n  $scope.ValidtorTime = function(dt1, dt2) {\n    var d1 = new Date(dt1).getTime();\n    var d2 = new Date(dt2).getTime();\n    if (d1 >= d2) {\n      return false;\n    }\n    return true;\n  };\n  //设定微信调用\n  $scope.Load_WX = function() {\n    wx.config({\n      debug: false,\n      appId: $scope.AppId,\n      timestamp: 1437377735,\n      nonceStr: 'n580440',\n      signature: window.localStorage.getItem($scope.AppId + \"_signature\"),\n      jsApiList: ['checkJsApi', 'onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'translateVoice', 'startRecord', 'stopRecord', 'onRecordEnd', 'playVoice', 'pauseVoice', 'stopVoice', 'uploadVoice', 'downloadVoice', 'chooseImage', 'previewImage', 'uploadImage', 'downloadImage', 'getNetworkType', 'openLocation', 'getLocation', 'hideOptionMenu', 'showOptionMenu', 'closeWindow', 'scanQRCode', 'chooseWXPay', 'openProductSpecificView', 'addCard', 'chooseCard', 'openCard']\n    });\n    wx.error(function(res) {\n      $http({\n        url: ApiMapper.wxApi + '/wx/r/ticket/' + $scope.AppId,\n        method: 'GET',\n        cache: false,\n        contentType: 'application/json'\n      }).success(function(data) {\n        var ticket = data;\n        window.localStorage.setItem($scope.AppId + \"_ticket\", ticket);\n        var String1 = \"jsapi_ticket=\" + ticket + \"&noncestr=n580440&timestamp=1437377735&url=\" + window.location.href;\n        window.localStorage.setItem($scope.AppId + \"_signature\", hex_sha1(String1)); //alert(String1);\n        $scope.Load_WX();\n      });\n    });\n  };\n  $scope.Load_WX();\n  wx.ready(function() {\n    //判断是否门店人员\n    if (parseInt($scope.StoreUser) == 0) {\n      $scope.ChangeTag = 2;\n      //alert(\"非门店人员，请去电<4001-580440>报修中心客服，进行部门转换，谢谢！\");\n      //wx.closeWindow();\n    }\n  });\n  //获取门店二维码\n  $scope.loadQRcode = function() {\n    $http({\n      url: ApiMapper.sApi + '/s/unit/info/qrcode/' + $scope.UnitId,\n      contentType: 'application/json',\n      headers: {\n        'Passport': $cookies.Passport\n      },\n      method: \"GET\",\n    }).success(function(data) {\n      $scope.ViewObj.QRCodeUri = data;\n    }).error(function(data) {\n      alert(data.Messages);\n    });\n  };\n  $scope.loadQRcode();\n  //调用微信扫一扫接口\n  $scope.ToscanQRCode = function() {\n    //微信扫一扫功能\n    wx.scanQRCode({\n      needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，\n      scanType: [\"qrCode\", \"barCode\"], // 可以指定扫二维码还是一维码，默认二者都有\n      success: function(res) {\n        $scope.QRCodeStr = res.resultStr;\n        //解密门店二维码信息\n        $http({\n          url: ApiMapper.sApi + '/s/unit/info/decrypt?encrypt=' + encodeURIComponent($scope.QRCodeStr),\n          contentType: 'application/json',\n          headers: {\n            'Passport': $cookies.Passport\n          },\n          method: \"GET\",\n        }).success(function(data) {\n          $scope.UnitInfo.Unit = data.UnitName;\n          $scope.UnitInfo.UnitId = data.UnitId;\n          $scope.UnitInfo.PassCode = data.PassCode;\n        }).error(function(data) {\n          alert(data.Messages);\n        });\n      }\n    });\n  };\n  //获取人员支援信息\n  $scope.getSupportInfo = function() {\n    $http({\n      url: ApiMapper.sApi + '/s/user/records/' + $scope.UserId,\n      method: 'GET',\n      contentType: 'application/json',\n      headers: {\n        'Passport': $scope.Passport\n      }\n    }).success(function(data) {\n      if (data.length > 0) {\n        _.each(data, function(Item) {\n          if (!$scope.ValidtorTime($scope.GetNow(), Item.StartTime) && !$scope.ValidtorTime(Item.EndTime, $scope.GetNow())) {\n            Item.StartTime = $scope.FormatDATE(Item.StartTime);\n            Item.EndTime = $scope.FormatDATE(Item.EndTime);\n            $scope.supportInfo = Item;\n            $scope.supportShow = true;\n            $scope.SupportList.push(Item);\n          }\n        });\n      }\n    }).error(function(data) {\n      alert(data.Messages);\n    });\n  };\n  $scope.getSupportInfo();\n  //我要调店操作\n  $scope.TransferSubmit = function() {\n    $scope.isSubmit = true;\n    $scope.ApiStr = ApiMapper.sApi + '/s/user/transfer/' + $scope.UserId; //人员调店\n    $scope.PostParames = {\n      'Source': 4,\n      'UnitId': $scope.UnitInfo.UnitId,\n      'PassCode': $scope.UnitInfo.PassCode\n    };\n    $scope.alertStr = \"是否调店至\";\n    if ($scope.UnitInfo.UnitId.toUpperCase() == $scope.UnitId.toUpperCase()) {\n      if (parseInt($scope.ChangeTag) == 0) {\n        $scope.isSubmit = false;\n        alert(\"调职门店和当前门店一样，不需要调店！\");\n        return false;\n      } else {\n        $scope.isSubmit = false;\n        alert(\"支援门店和当前门店一样，不允许操作！\");\n        return false;\n      }\n    }\n    if (parseInt($scope.ChangeTag) == 1) {\n      $scope.ApiStr = ApiMapper.sApi + '/s/user/support/' + $scope.UserId; //支援\n      $scope.alertStr = \"是否支援门店：\";\n      $scope.StartTime = $('#StartTime').val();\n      $scope.EndTime = $('#EndTime').val();\n      if ($scope.StartTime == \"\" || $scope.EndTime == \"\") {\n        $scope.isSubmit = false;\n        alert(\"请选择支援起迄日期！\");\n        return false;\n      } else if ($scope.ValidtorTime($scope.FormatDATE($scope.EndTime), $scope.FormatDATE($scope.StartTime))) {\n        $scope.isSubmit = false;\n        alert(\"开始时间必须早于结束时间！\");\n        return false;\n      } else if ($scope.ValidtorTime($scope.FormatDATE($scope.EndTime), $scope.GetNow())) {\n        $scope.isSubmit = false;\n        alert(\"结束时间需晚于当前时间！\");\n        return false;\n      } else {\n        $scope.PostParames = {\n          'Info': {\n            'Source': 4,\n            'UnitId': $scope.UnitInfo.UnitId,\n            'Unit': $scope.UnitInfo.Unit,\n            'StartTime': $scope.StartTime,\n            'EndTime': $scope.EndTime\n          },\n          'PassCode': $scope.UnitInfo.PassCode\n        };\n      }\n    }\n    if ($scope.UnitInfo.Unit == '') {\n      $http({\n        url: ApiMapper.sApi + '/s/unit/' + $scope.UnitInfo.UnitId,\n        contentType: 'application/json',\n        headers: {\n          'Passport': $cookies.Passport\n        },\n        method: \"GET\",\n      }).success(function(data) {\n        if (data.StatusCode != \"null\" && data.StatusCode != null) {\n          $scope.isSubmit = false;\n          alert(\"门店编号不对，请重新输入！\");\n        } else {\n          $scope.UnitInfo.Unit = data.Unit;\n          if (confirm($scope.alertStr + \"<\" + $scope.UnitInfo.Unit + \">\")) {\n            $http({\n              url: $scope.ApiStr,\n              method: 'PATCH',\n              contentType: 'application/json',\n              headers: {\n                'Passport': $scope.Passport\n              },\n              data: $scope.PostParames\n            }).success(function(data) {\n              //调店成功重新获取用户数据\n              if (data.StatusCode == 1 && parseInt($scope.ChangeTag) == 1) {\n                alert(\"支援门店<\" + $scope.UnitInfo.Unit + \">成功！\");\n                wx.closeWindow();\n              } else if (data.StatusCode == 1 && parseInt($scope.ChangeTag) == 0) {\n                alert(\"成功调店至<\" + $scope.UnitInfo.Unit + \">！\");\n                wx.closeWindow();\n              } else {\n                $scope.isSubmit = false;\n                alert(data.Messages);\n              }\n            }).error(function(data) {\n              $scope.isSubmit = false;\n              alert(data.Messages);\n            });\n          } else {\n            $scope.UnitInfo.Unit = \"\";\n            $scope.isSubmit = false;\n          }\n        }\n      }).error(function(data) {\n        $scope.isSubmit = false;\n        alert(\"网络错误请联系报修中心！\");\n      });\n    } else {\n      if (confirm($scope.alertStr + \"<\" + $scope.UnitInfo.Unit + \">\")) {\n        $http({\n          url: $scope.ApiStr,\n          method: 'PATCH',\n          contentType: 'application/json',\n          headers: {\n            'Passport': $scope.Passport\n          },\n          data: $scope.PostParames\n        }).success(function(data) {\n          //调店成功重新获取用户数据\n          if (data.StatusCode == 1 && parseInt($scope.ChangeTag) == 1) {\n            alert(\"支援门店<\" + $scope.UnitInfo.Unit + \">成功！\");\n            wx.closeWindow();\n          } else if (data.StatusCode == 1 && parseInt($scope.ChangeTag) == 0) {\n            alert(\"成功调店至<\" + $scope.UnitInfo.Unit + \">！\");\n            wx.closeWindow();\n          } else {\n            $scope.isSubmit = false;\n            alert(data.Messages);\n          }\n        }).error(function(data) {\n          $scope.isSubmit = false;\n          alert(data.Messages);\n        });\n      } else {\n        $scope.UnitInfo.Unit = \"\";\n        $scope.isSubmit = false;\n      }\n    }\n  };\n}])\n.controller(\"AddAllotCtrl\", [\"$scope\", \"$http\", \"$cookies\", \"$timeout\", \"$mdSidenav\", \"$modal\", \"$mdDialog\", \"i18n\", function($scope, $http, $cookies, $timeout, $mdSidenav, $modal, $mdDialog, i18n) {\n  $scope.StoreUser = $cookies.StoreUser;\n  $scope.CompanyId = $cookies.CompanyId;\n  $scope.StoreUser = $cookies.StoreUser;\n  $scope.Unit = $cookies.Unit;\n  $scope.Maintenance = 0;\n  //取得openID\n  //流程是AppID(公眾號ID) > codeID(驗證碼) > openID(使用者在這個公眾號的ID) > (API) > 使用者資訊\n  $scope.AppId = ApiMapper.AppId;\n  $scope.OpenId = window.localStorage.getItem($scope.AppId);\n  $scope.EquipmentName = \"\";\n  $scope.OpenModalTag = \"Source\";\n  $scope.MoveOrderParameters = {\n    \"RequisitionId\": null,\n    \"MoveType\": 1,\n    \"IsMove\": false,\n    \"IsClose\": false,\n    \"SourceId\": $cookies.UnitId,\n    \"Source\": $cookies.Unit,\n    \"TargetId\": \"\",\n    \"Target\": \"\",\n    \"Remark\": \"\",\n    \"EquipmentId\": \"\",\n    \"EquipmentName\": \"\"\n  };\n  $scope.EquipmentList = [{\n    'EquipmentTypeClass': 0,\n    'ClassName': '设备',\n    'children': []\n  }, {\n    'EquipmentTypeClass': 1,\n    'ClassName': '设施',\n    'children': []\n  }, {\n    'EquipmentTypeClass': 2,\n    'ClassName': '资讯',\n    'children': []\n  }, {\n    'EquipmentTypeClass': 99,\n    'ClassName': '其它',\n    'children': []\n  }];\n  $scope.StoreList = []; //門店json\n  $scope.EquipmentList = [];\n  $scope.isSubmit = false;\n  $scope.IsShowToScanQRCode = false;\n  $scope.IsShowAddCause = false;\n  $scope.IsWPStylePriorityList = false;\n  $scope.IsAutoSetPosition = false;\n  // 王品 5/23\n  var Client_Permissions = [\"f96f98e2-38f9-456a-9813-82d899536a82\", \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\", \"6c690014-2571-48db-ac5a-c6ba2572a3bb\", \"c1a24352-46a1-4301-9b96-a67c92691336\", \"C4B0E179-8121-487E-AA63-59635ACF2447\"];\n  if (Client_Permissions.indexOf($cookies.CompanyId) > -1) {\n    $scope.IsShowToScanQRCode = true;\n    $scope.IsShowAddCause = true;\n    $scope.IsWPStylePriorityList = true;\n    //if(parseInt($scope.StoreUser) === 1){\n    if ($cookies.CompanyId !== 'f96f98e2-38f9-456a-9813-82d899536a82' && $cookies.CompanyId !== 'c1a24352-46a1-4301-9b96-a67c92691336') {\n      $scope.isWPStoreUser = true;\n    }\n    //}\n  };\n  if (Client_Permissions.indexOf($cookies.CompanyId) > -1) {\n    $scope.IsAutoSetPosition = true;\n  };\n  //获取单位资料\n  $scope.GetStore = function() {\n    $http({\n      url: ApiMapper.sApi + '/s/unit/maps',\n      method: 'GET',\n      cache: true,\n      contentType: 'application/json',\n      headers: {\n        'Passport': $cookies.Passport\n      }\n    }).success(function(Unitdata) {\n      $scope.Unitdata = Unitdata;\n      // alert(JSON.stringify($scope.Unitdata));\n      _.each(Unitdata[1], function(Item1) {\n        $scope.UnitLeve4data = [];\n        Item1.isSelected = false;\n        _.each(Unitdata[3], function(Item2) {\n          $scope.UnitLeve4data.push(Item2);\n          if (Item2.Level2 == Item1.UnitId) {\n            Item2.Level2Name = Item1.Unit;\n            Item2.isSelected = false;\n          }\n          if (Item2.UnitId == $cookies.UnitId) {\n            $scope.MoveOrderParameters.SourceId = Item2.UnitId;\n            $scope.MoveOrderParameters.Source = Item2.Unit;\n            //报修单位才去获取部门设备列表\n            $scope.GetEquipment($cookies.UnitId);\n          }\n        });\n        $scope.StoreList.push(Item1);\n      });\n    }).error(function(status) {\n      alert(\"获取部门信息错误！\");\n    });\n  };\n  $scope.GetStore();\n  //获取设备/设施\n  $scope.GetEquipment = function(UnitId) {\n    var parameterStr = {\n      'UnitId': $scope.MoveOrderParameters.SourceId,\n      'TopicType': 1,\n      'Maintenance': $scope.Maintenance\n    };\n    if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"c1a24352-46a1-4301-9b96-a67c92691336\") {\n      parameterStr.TopicType = 3;\n      $scope.EquipmentList[0] = {\n        'EquipmentTypeClass': 0,\n        'ClassName': '设备',\n        'children': []\n      };\n      $scope.EquipmentList[1] = {\n        'EquipmentTypeClass': 1,\n        'ClassName': '设施',\n        'children': []\n      };\n      $scope.GetFacilities(); //获取设施列表\n    };\n    $http({\n      url: ApiMapper.sApi + '/s/equipment/classification',\n      method: 'POST',\n      contentType: 'application/json',\n      headers: {\n        'Passport': $cookies.Passport\n      },\n      data: JSON.stringify(parameterStr)\n    }).success(function(data) {\n      $scope.EquipmentList = [{\n        'EquipmentTypeClass': 0,\n        'ClassName': '设备',\n        'children': []\n      }, {\n        'EquipmentTypeClass': 1,\n        'ClassName': '设施',\n        'children': []\n      }, {\n        'EquipmentTypeClass': 2,\n        'ClassName': '资讯',\n        'children': []\n      }, {\n        'EquipmentTypeClass': 99,\n        'ClassName': '其它',\n        'children': []\n      }];\n      if ($scope.CompanyId == \"eb296708-6fc6-43f0-b506-0ca0fa91e1cd\" || $scope.CompanyId == \"6c690014-2571-48db-ac5a-c6ba2572a3bb\" || $scope.CompanyId == \"c1a24352-46a1-4301-9b96-a67c92691336\") {\n        $scope.EquipmentList[0].children = data;\n        // _($scope.EquipmentList[0].children).each(function (Item) {\n        //     Item.ClassName = Item.EquipmentTypeName;\n        // });\n      } else {\n        _.each(data, function(Items) {\n          var EquipmentList = Items.children;\n          _.each(EquipmentList, function(Lists) {\n            Lists.EquipmentTypeName = Items.EquipmentTypeName;\n            var EquipmentCode = Lists.EquipmentCode.split('-');\n            Lists.SortNo = parseInt(EquipmentCode[1]);\n            $scope.EquipmentList.forEach(function(equipmentType, index) {\n              if (equipmentType.EquipmentTypeClass == Lists.EquipmentTypeClass) {\n                $scope.EquipmentList[index].children.push(Lists);\n              };\n            });\n          });\n        });\n        _.each($scope.EquipmentList, function(Item) {\n          Item.children = _.sortBy(Item.children, 'SortNo');\n        });\n      }\n    });\n  };\n  //获取王品设施列表\n  $scope.GetFacilities = function() {\n    var parameterStr = {\n      'UnitId': $scope.MoveOrderParameters.SourceId,\n      'TopicType': 4,\n      'Maintenance': $scope.Maintenance\n    };\n    $http({\n      url: ApiMapper.sApi + '/s/equipment/classification',\n      method: 'POST',\n      contentType: 'application/json',\n      headers: {\n        'Passport': $cookies.Passport\n      },\n      data: JSON.stringify(parameterStr)\n    }).success(function(res) {\n      _.each(res, function(Items) {\n        var EquipmentList = Items.children;\n        _.each(EquipmentList, function(Lists) {\n          Lists.EquipmentTypeName = Items.EquipmentTypeName;\n          var EquipmentCode = Lists.EquipmentCode.split('-');\n          Lists.SortNo = parseInt(EquipmentCode[1]);\n          $scope.EquipmentList[1].children.push(Lists);\n        });\n      });\n    });\n  };\n  //选择设备帶入地區資料\n  $scope.ShowArea = function(Equipment, PositionByTypeEquipmentTypeName) {\n    //王品设施不显示区域 2019R5\n    if (PositionByTypeEquipmentTypeName === \"设施\" && $scope.isWPStoreUser) {\n      $scope.isShowArea = false;\n    } else {\n      $scope.isShowArea = true;\n    }\n    $scope.MoveOrderParameters.EquipmentId = Equipment.EquipmentId;\n    $scope.MoveOrderParameters.EquipmentName = Equipment.EquipmentName;\n    $scope.closeDenav('EQ');\n  };\n  $scope.isSelectLeve2 = function(UnitItem) {\n    _.each($scope.Unitdata[1], function(Item) {\n      Item.isSelected = false;\n      if (Item.UnitId == UnitItem.UnitId) {\n        UnitItem.isSelected = !UnitItem.isSelected;\n      }\n    });\n    if (UnitItem.isSelected) {\n      $scope.AreaIds = [UnitItem.UnitId];\n      $scope.ProvinceIds = [];\n    }\n    $scope.UnitLeve3data = _.filter($scope.Unitdata[2], function(Item) {\n      return Item.Level2 == UnitItem.UnitId;\n    });\n  };\n  $scope.isSelectLeve2 = function(UnitItem) {\n    _.each($scope.Unitdata[1], function(Item) {\n      Item.isSelected = false;\n      if (Item.UnitId == UnitItem.UnitId) {\n        UnitItem.isSelected = !UnitItem.isSelected;\n      }\n    });\n    if (UnitItem.isSelected) {\n      $scope.AreaIds = [UnitItem.UnitId];\n      $scope.ProvinceIds = [];\n    }\n    $scope.UnitLeve3data = _.filter($scope.Unitdata[2], function(Item) {\n      return Item.Level2 == UnitItem.UnitId;\n    });\n  };\n  $scope.isSelectLeve3 = function(UnitItem) {\n    _.each($scope.Unitdata[2], function(Item) {\n      Item.isSelected = false;\n      if (Item.UnitId == UnitItem.UnitId) {\n        UnitItem.isSelected = !UnitItem.isSelected;\n      }\n    });\n    if (UnitItem.isSelected) {\n      $scope.ProvinceIds = [UnitItem.UnitId];\n    }\n  };\n  $scope.reLoadLeve4 = function() {\n    $scope.UnitLeve4data = _.filter($scope.Unitdata[3], function(Item) {\n      if ($scope.ProvinceIds.length > 0) {\n        return Item.Level3 == $scope.ProvinceIds[0];\n      } else {\n        return Item.Level2 == $scope.AreaIds[0];\n      }\n    });\n  };\n  $scope.isSelectLeve4 = function(UnitItem) {console.log(UnitItem);\n    _.each($scope.UnitLeve4data, function(Item) {\n      Item.isSelected = false;\n      if (Item.UnitId == UnitItem.UnitId) {\n        UnitItem.isSelected = !UnitItem.isSelected;\n      }\n    });\n    if (UnitItem.isSelected) { //將門店資料帶回\n      if ($scope.OpenModalTag == \"Target\") {\n        $scope.MoveOrderParameters.TargetId = UnitItem.UnitId;\n        $scope.MoveOrderParameters.Target = UnitItem.Unit;\n      } else {\n        $scope.MoveOrderParameters.SourceId = UnitItem.UnitId;\n        $scope.MoveOrderParameters.Source = UnitItem.Unit;\n        $scope.GetEquipment($scope.MoveOrderParameters.SourceId);\n      }\n      console.log($scope.MoveOrderParameters);\n    }\n  };\n  $scope.toggleRight = function(navID) {\n    $scope.OpenModalTag = navID;\n    if (navID === \"Target\" || navID === \"Source\") {\n      $mdSidenav(\"Store\").open();\n    } else {\n      $mdSidenav(\"EQ\").open();\n    }\n  };\n  $scope.closeDenav = function(navID) {\n    if (navID === \"Store\") {\n      _.each($scope.UnitLeve4data, function(Item) {\n        Item.isSelected = false;\n      });\n      $mdSidenav('Store').close();\n    } else {\n      $mdSidenav(\"EQ\").close();\n    }\n  };\n\n  //设施设备modal关闭事件\n  $scope.EQ_close = function(e) {\n    $mdSidenav('EQ').close().then(function() {});\n  };\n \n  $scope.MoveOrderSubmit = function() {\n    if ($scope.MoveOrderParameters.EquipmentId == \"\") {\n      alert(\"请选择调拨品项\");\n    } else {\n      $http({\n        url: ApiMapper.sApi + '/s/moveOder/create',\n        method: 'POST',\n        contentType: 'application/json',\n        headers: {\n          'Passport': $cookies.Passport\n        },\n        data: $scope.MoveOrderParameters\n      }).success(function(data) {\n        $scope.isSubmit = false;\n        alert(\"调拨成功！详情请只调拨列表查看。\");\n        $scope.MoveOrderParameters = {\n          \"RequisitionId\": null,\n          \"MoveType\": 1,\n          \"SourceId\": $cookies.UnitId,\n          \"Source\": $cookies.Unit,\n          \"TargetId\": \"\",\n          \"Target\": \"\",\n          \"Remark\": \"\",\n          \"IsMove\": false,\n          \"IsClose\": false,\n          \"EquipmentId\": \"\",\n          \"EquipmentName\": \"\"\n        };\n      }).error(function(data) {\n        $scope.isSubmit = false;\n        alert(data.Messages);\n      });\n    }\n  };\n}]);"]}
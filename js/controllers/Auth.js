"use strict";WeChat.controller("AuthCtrl",["$scope","$http","$location","$window","$cookies","$q","md5","i18n",function(t,e,r,o,n,s,i,p){t.isShowLogin=!1,t.bind2Store=!1,t.isUsed=!1,t.QRCodeStr="",t.username="",t.userpassword="",t.passCode="",t.UserInfo={UnitId:"",UserName:"",UserId:"",SigninType:2,Contacts:[{Type:1,Info:"",UserId:""}]},t.isUnitManager={value:0},t.UnitInfo={Unit:"",UnitId:"",passCode:""},t.UserInfo02={UserId:"",Password:""},t.AppId=ApiMapper.AppId,console.log("目前AppID: "+t.AppId),t.isOurAppId=!1,"wxb04d43e40105795a"!=t.AppId&&"wxb39ebe28ba7036a5"!=t.AppId||(t.isOurAppId=!0),null!=t.AppId&&null!=t.AppId||(t.AppId=ApiMapper.AppId,window.localStorage.setItem("b2c_appId",t.AppId),window.localStorage.setItem("RedirectUri","account_success.html")),t.UrlStr=$(location).attr("search")||"Unknown","Unknown"!=t.UrlStr&&(t.RedirectUri=decodeURIComponent(t.UrlStr.split("?redirect_uri=")[1]),t.RedirectUri=t.RedirectUri.replace("&","?"),t.Code=decodeURIComponent(t.UrlStr.split("?code=")[1]));var a=ApiMapper.PathStr+"account_success.html";t.OpenId=window.localStorage.getItem(t.AppId),t.GetAccountInfo=function(){e({url:ApiMapper.lineApi+"/line/s/signin/"+t.OpenId,method:"GET"}).success(function(e){if(100==e.Code){var r=e.o[0];n.UserId=r.Id,n.Passport=r.Passport,n.UnitId=r.UnitId,n.Unit=r.Unit,n.UserName=r.Name,n.CompanyId=r.CompanyId,n.StoreUser=r.StoreUser,n.ExpiredTime=r.ExpiredTime,n.Updated=r.Updated,window.localStorage.setItem("Passport",r.Passport),t.ValidtorTime(r.ExpiredTime,t.GetNow())&&1==parseInt(r.StoreUser)&&0==parseInt(r.Updated)?location.replace(ApiMapper.PathStr+"confirm_PassCode.html"):1==r.ChangePassword?(a=ApiMapper.PathStr+"forget_Password.html",location.replace(a)):window.location.href=a}else 209===parseInt(e.Code)?(a=ApiMapper.PathStr+"noService.html",location.replace(a)):t.isShowLogin=!0}).error(function(e){t.isShowLogin=!0})},t.getOpenId=function(){null==t.UrlStr.split("?redirect_uri=")[1]||(a=decodeURIComponent(t.UrlStr.split("?redirect_uri=")[1])),t.GetAccountInfo()},t.getOpenId(),t.AccountSubmit=function(){if(t.username=$("[name=username]").val(),t.bind2Store){if(""==t.UserInfo.UnitId||""==t.UserInfo.UserName||""==t.UserInfo.UserId||""==t.UserInfo.Contacts[0].Info||""==t.UnitInfo.passCode)return alert(p.t("20051")),!1;t.submitUrl=ApiMapper.wxApi+"/wx/reg/"+t.OpenId+"/"+t.AppId+"/"+t.UnitInfo.passCode+"?isUnitManager="+t.isUnitManager.value,t.UserInfo.Contacts[0].UserId=t.UserInfo.UserId,t.UserInfo.HrCode=t.UserInfo.UnitId}else{if(""==t.UserInfo02.UserId||""==t.UserInfo02.Password)return alert(p.t("20050")),!1;t.submitUrl=ApiMapper.wxApi+"/wx/reg/"+t.OpenId+"/"+t.AppId,t.UserInfo={Id:t.UserInfo02.UserId,Password:i.createHash(t.UserInfo02.Password||"")}}e({url:t.submitUrl,data:t.UserInfo,contentType:"application/json",method:"PATCH"}).success(function(e){1==e.StatusCode?t.GetAccountInfo():209===parseInt(e.Code)&&(alert(e.Messages),wx.closeWindow())}).error(function(e){alert(e.Messages),209===parseInt(e.Code)&&wx.closeWindow()})}}]);
//# sourceMappingURL=Auth.js.map
